<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartoListen - AI Mental Health Support</title>
    <link rel="manifest" href="manifest.json">
    <meta name="description" content="Free AI-powered mental health support chat. A safe, judgment-free space for mental wellness.">
    <meta name="theme-color" content="#2E8B57">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#4ade80">

    <!-- Apple-specific meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Hear to Listen">

    <!-- Apple touch icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">

    <!-- Microsoft tiles -->
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#4ade80">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .logo {
            width: 150px;
            height: 150px;
            margin-bottom: 15px;
            border-radius: 50%;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .header {
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            padding: 20px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.5;
        }

        .ai-message {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            color: #333;
            align-self: flex-start;
            border: 1px solid rgba(103, 126, 234, 0.1);
        }

        .user-message {
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            color: white;
            align-self: flex-end;
        }

        .input-area {
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }

        .input-field:focus {
            border-color: #2E8B57;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: #f0f0f0;
            padding: 15px 20px;
            border-radius: 18px;
            margin-top: 10px;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        .welcome-message {
            text-align: center;
            color: #666;
            margin: 20px 0;
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 15px;
            border: 1px dashed rgba(102, 126, 234, 0.2);
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }

        .quick-action {
            padding: 8px 16px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            color: #2E8B57;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.85em;
            color: #856404;
            text-align: center;
        }

        .crisis-resources {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #0c5460;
        }

        .crisis-resources h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .crisis-resources p {
            margin: 5px 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        @media (max-width: 600px) {
            .container {
                height: 100vh;
                border-radius: 0;
                max-width: 100%;
            }
            
            .message {
                max-width: 90%;
            }
            
            .header h1 {
                font-size: 1.5em;
            }

            body {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <script src="pwa.js"></script>
    
    <div class="container">
        <div class="header">
            <img src="heartolisten-logo.png.png" alt="HeartoListen" class="logo">
            <h1>HeartoListen</h1>
            <p>Your compassionate AI companion for mental wellness</p>
        </div>
        
        <div class="chat-area" id="chatArea">
            <div class="welcome-message">
                <h3>Welcome to HeartoListen</h3>
                <p>I'm here to listen and support you through whatever you're experiencing. This is a safe, judgment-free space where you can share your thoughts and feelings.</p>
                
                <div class="disclaimer">
                    <strong>Important:</strong> This is an AI tool for support and guidance. In case of crisis or emergency, please contact professional help immediately.
                </div>

                <div class="crisis-resources">
                    <h4>ðŸ†˜ Crisis Resources</h4>
                    <p><strong>US:</strong> 988 (Suicide & Crisis Lifeline) </p>
                    <p><strong>UK:</strong> 116 123 (Samaritans) | Text SHOUT to 85258</p>
                    <p><strong>Emergency:</strong> 911 (US) | 999 (UK)</p>
                </div>
                
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('I\'m feeling anxious today')">I'm feeling anxious</div>
                    <div class="quick-action" onclick="sendQuickMessage('I need some motivation')">Need motivation</div>
                    <div class="quick-action" onclick="sendQuickMessage('I\'m having trouble sleeping')">Sleep troubles</div>
                    <div class="quick-action" onclick="sendQuickMessage('I feel overwhelmed')">Feeling overwhelmed</div>
                </div>
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" class="input-field" id="messageInput" placeholder="Share what's on your mind..." />
            <button class="send-button" id="sendButton" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        const chatArea = document.getElementById('chatArea');
        const messageInput = document.getElementById('messageInput');
        const typingIndicator = document.getElementById('typingIndicator');
        
        // Conversation tracking
        let conversationHistory = [];
        let currentTopic = null;
        let messageCount = 0;
        let userEmotions = [];
        
        // CBT-based empathetic responses with conversation flow
        const responseSystem = {
            // Initial responses to emotions
            anxiety: {
                initial: [
                    "I can hear the anxiety in what you're sharing, and I want you to know that what you're experiencing is real and valid. Anxiety often tells us stories about what might happen - what thoughts are going through your mind right now?",
                    "It sounds like anxiety is really weighing on you today. That must feel exhausting. When you notice these anxious feelings, what do you typically tell yourself about them?",
                    "Thank you for trusting me with how you're feeling. Anxiety can make everything feel urgent and overwhelming. I'm curious - when did you first start noticing these feelings today?"
                ],
                followUp: [
                    "I'm hearing that this anxiety is persistent for you. Sometimes our minds try to protect us by imagining worst-case scenarios. What evidence do you have for and against the thoughts that are making you anxious?",
                    "It sounds like you've been carrying this worry for a while. In CBT, we often explore whether our thoughts are helpful or just familiar. What would you tell a close friend if they shared this same concern with you?",
                    "You mentioned feeling anxious about [topic]. Sometimes it can help to separate what we can control from what we can't. What aspects of this situation, if any, do you feel you have some influence over?"
                ],
                deeper: [
                    "I notice you keep coming back to these anxious thoughts. That's really common - our brains sometimes get stuck in loops trying to solve problems. What do you think might happen if you allowed yourself to sit with the uncertainty for just a moment?",
                    "It seems like this anxiety might be connected to some deeper concerns about [related theme]. Sometimes our current worries are our mind's way of processing bigger life questions. Does that resonate with you at all?"
                ]
            },
            
            sad: {
                initial: [
                    "I can feel the heaviness in your words, and I want you to know that it's okay to sit with these feelings. Sadness often carries important messages about what matters to us. What do you think your sadness might be trying to tell you?",
                    "There's a real weight to what you're sharing, and I'm honored that you feel safe enough to express this here. When you think about this sadness, does it feel familiar, or is this something new you're experiencing?",
                    "It takes courage to acknowledge feeling sad, especially when the world often tells us to 'just be positive.' What's it like for you to name these feelings out loud?"
                ],
                followUp: [
                    "You've shared some really difficult experiences. I'm wondering - when you think about this sadness, what thoughts come up about yourself or your situation?",
                    "I'm noticing that you seem to be really hard on yourself about feeling this way. What would it be like to treat yourself with the same compassion you'd show a good friend going through this?",
                    "This sadness sounds connected to some significant losses or changes in your life. Sometimes our emotions are perfectly logical responses to difficult circumstances. What feels most important for you to be heard about right now?"
                ],
                deeper: [
                    "You've been so open about this pain you're carrying. I'm curious about the story you tell yourself about why you're feeling this way. Are there any patterns or themes you notice?",
                    "It seems like this sadness touches on some fundamental questions about [identity/relationships/purpose]. Sometimes our deepest emotions point us toward what we most need or value. What do you think this feeling might be highlighting for you?"
                ]
            },
            
            overwhelmed: {
                initial: [
                    "It sounds like you have so much on your plate right now. When everything feels like 'too much,' our minds can start racing to try to handle it all at once. What's the loudest voice in your head telling you right now?",
                    "I can sense the weight of everything you're juggling. Feeling overwhelmed is often our system's way of saying we need to slow down and prioritize. What would it feel like to give yourself permission to not handle everything perfectly?",
                    "There's a lot coming through in what you're sharing - it makes complete sense that you'd feel overwhelmed. When you imagine getting through this, what comes up for you?"
                ],
                followUp: [
                    "You mentioned feeling like you 'should' be able to handle all of this. I'm curious about that word 'should' - where do you think that expectation comes from?",
                    "It sounds like you're putting a lot of pressure on yourself to manage everything at once. What would it be like to approach this differently - maybe focusing on what truly needs your attention today?",
                    "I hear you saying you feel like you're failing or not doing enough. What evidence do you have that challenges that thought? What would someone who cares about you say about how you're handling things?"
                ],
                deeper: [
                    "We've talked about several areas where you feel overwhelmed. I'm noticing some themes around [control/perfectionism/others' expectations]. What do you think is really at the heart of this feeling?",
                    "You've been so aware of all the external demands on you. I'm wondering about your internal experience - what do you most need emotionally to feel more grounded?"
                ]
            },
            
            stress: {
                initial: [
                    "I can hear the tension in what you're describing. Stress often builds up when we're facing demands that feel bigger than our current resources. What part of this stress feels most pressing to you right now?",
                    "It sounds like stress has become a constant companion for you lately. Our bodies and minds are designed to handle short bursts of stress, but chronic stress is different. How is this showing up in your daily life?",
                    "Thank you for sharing what's creating stress for you. Sometimes when we're in the middle of it, everything can feel equally urgent. What would it be like to imagine that not everything needs to be solved today?"
                ],
                followUp: [
                    "You've described several stressful situations. I'm curious about your thoughts around these challenges - are you noticing any patterns in how you talk to yourself about them?",
                    "It seems like this stress might be connected to feeling responsible for outcomes that may be partly outside your control. What parts of these situations do you feel you have genuine influence over?",
                    "I hear you trying to anticipate and prepare for so many different scenarios. While planning can be helpful, sometimes our minds create stress by trying to solve problems that haven't happened yet. What's it like to consider focusing just on today?"
                ],
                deeper: [
                    "We've explored several sources of stress in your life. There seems to be a theme around [perfectionism/control/others' approval]. How do you think you learned to carry stress this way?",
                    "I'm noticing that beneath this stress, there might be some deeper concerns about [safety/worth/belonging]. Sometimes our stress is our mind's way of trying to protect something important to us. What do you think yours might be protecting?"
                ]
            },
            
            general: {
                initial: [
                    "I'm really glad you reached out today. There's something brave about taking the time to check in with yourself and seek support. What's been occupying your thoughts lately?",
                    "Thank you for being here and sharing your time with me. I'm curious about what brought you here today - what's been on your mind or in your heart?",
                    "I appreciate you taking this step to connect. Sometimes just having a space to think out loud can be really valuable. What would feel most helpful for you right now?"
                ],
                followUp: [
                    "I'm hearing several different themes in what you're sharing. What feels most important to you to explore right now?",
                    "It sounds like you've been doing a lot of thinking about this. I'm curious about your internal dialogue - what story are you telling yourself about your situation?",
                    "You've shared some really meaningful reflections. What's it like for you to put these thoughts into words?"
                ],
                deeper: [
                    "As we've been talking, I'm noticing some patterns in how you describe your experiences. What do you make of that?",
                    "You've been so thoughtful in sharing your perspective. I'm wondering what insights you're having about yourself through our conversation?"
                ]
            }
        };

        // CBT-based thought exploration prompts
        const thoughtExploration = [
            "What evidence supports this thought, and what evidence challenges it?",
            "If a close friend had this same thought, what would you tell them?",
            "What would it feel like to consider a different perspective on this situation?",
            "How might you think about this differently on a day when you're feeling more balanced?",
            "What's the most realistic way to look at this situation?",
            "What would be most helpful for you to believe about yourself right now?"
        ];

        // Conversation development prompts
        const conversationDevelopers = [
            "Tell me more about that...",
            "What was that experience like for you?",
            "How did that affect you?",
            "What thoughts went through your mind when that happened?",
            "What feelings came up for you in that moment?",
            "How are you making sense of all this?",
            "What's the hardest part about this for you?",
            "What would it mean to you if you could work through this?"
        ];

        function analyzeEmotion(message) {
            const emotionKeywords = {
                anxiety: ['anxious', 'anxiety', 'worried', 'panic', 'nervous', 'scared', 'fear', 'afraid', 'terrified', 'uneasy'],
                sad: ['sad', 'depressed', 'down', 'cry', 'crying', 'hopeless', 'empty', 'lonely', 'grief', 'loss', 'hurt'],
                overwhelmed: ['overwhelmed', 'too much', 'can\'t cope', 'drowning', 'exhausted', 'burned out', 'swamped'],
                stress: ['stress', 'stressed', 'pressure', 'tension', 'burden', 'weight', 'demanding'],
                anger: ['angry', 'mad', 'furious', 'irritated', 'frustrated', 'annoyed', 'rage'],
                general: []
            };

            const message_lower = message.toLowerCase();
            
            for (const [emotion, keywords] of Object.entries(emotionKeywords)) {
                if (emotion === 'general') continue;
                if (keywords.some(keyword => message_lower.includes(keyword))) {
                    return emotion;
                }
            }
            return 'general';
        }

        function getConversationalResponse(userMessage, messageIndex) {
            const detectedEmotion = analyzeEmotion(userMessage);
            const responses = responseSystem[detectedEmotion];
            
            // Track conversation history
            conversationHistory.push({
                user: userMessage,
                emotion: detectedEmotion,
                timestamp: Date.now()
            });

            // Update current topic and user emotions
            if (detectedEmotion !== 'general') {
                currentTopic = detectedEmotion;
                if (!userEmotions.includes(detectedEmotion)) {
                    userEmotions.push(detectedEmotion);
                }
            }

            let response;
            
            // Determine response type based on conversation flow
            if (messageIndex === 0 || !currentTopic) {
                // First interaction or no specific topic
                response = responses.initial[Math.floor(Math.random() * responses.initial.length)];
            } else if (messageIndex < 3) {
                // Early conversation - follow up questions
                response = responses.followUp[Math.floor(Math.random() * responses.followUp.length)];
            } else {
                // Deeper conversation
                if (responses.deeper && Math.random() > 0.3) {
                    response = responses.deeper[Math.floor(Math.random() * responses.deeper.length)];
                } else {
                    // Mix in thought exploration and conversation developers
                    if (Math.random() > 0.5) {
                        response = thoughtExploration[Math.floor(Math.random() * thoughtExploration.length)];
                    } else {
                        response = conversationDevelopers[Math.floor(Math.random() * conversationDevelopers.length)];
                    }
                }
            }

            // Personalize response based on conversation history
            response = personalizeResponse(response, userMessage, detectedEmotion);
            
            return response;
        }

        function personalizeResponse(response, userMessage, emotion) {
            // Replace placeholders with context from the conversation
            if (response.includes('[topic]')) {
                response = response.replace('[topic]', extractTopic(userMessage));
            }
            if (response.includes('[related theme]')) {
                response = response.replace('[related theme]', getRelatedTheme(emotion));
            }
            if (response.includes('[identity/relationships/purpose]')) {
                const themes = ['your sense of identity', 'your relationships', 'your sense of purpose'];
                response = response.replace('[identity/relationships/purpose]', themes[Math.floor(Math.random() * themes.length)]);
            }
            if (response.includes('[control/perfectionism/others\' expectations]')) {
                const themes = ['needing control', 'perfectionism', 'others\' expectations'];
                response = response.replace('[control/perfectionism/others\' expectations]', themes[Math.floor(Math.random() * themes.length)]);
            }
            if (response.includes('[safety/worth/belonging]')) {
                const themes = ['feeling safe', 'your sense of worth', 'belonging and connection'];
                response = response.replace('[safety/worth/belonging]', themes[Math.floor(Math.random() * themes.length)]);
            }
            if (response.includes('[perfectionism/control/others\' approval]')) {
                const themes = ['perfectionism', 'having control', 'getting others\' approval'];
                response = response.replace('[perfectionism/control/others\' approval]', themes[Math.floor(Math.random() * themes.length)]);
            }
            
            return response;
        }

        function extractTopic(message) {
            // Simple topic extraction - could be enhanced
            const words = message.toLowerCase().split(' ');
            const topics = ['work', 'family', 'relationships', 'school', 'health', 'future', 'money', 'change'];
            const foundTopic = topics.find(topic => words.includes(topic));
            return foundTopic || 'this situation';
        }

        function getRelatedTheme(emotion) {
            const themes = {
                anxiety: 'uncertainty and control',
                sad: 'loss and connection',
                overwhelmed: 'expectations and boundaries',
                stress: 'pressure and self-worth'
            };
            return themes[emotion] || 'your inner experience';
        }

        function getAIResponse(userMessage) {
            return getConversationalResponse(userMessage, messageCount);
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            messageDiv.textContent = content;
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            messageInput.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate AI response delay - longer for more thoughtful responses
            setTimeout(() => {
                hideTypingIndicator();
                const aiResponse = getAIResponse(message);
                addMessage(aiResponse, false);
                messageCount++; // Increment message count for conversation tracking
            }, 2000 + Math.random() * 1500); // Random delay between 2-3.5 seconds for more realistic thinking time
        }

        function sendQuickMessage(message) {
            messageInput.value = message;
            sendMessage();
            // Hide welcome message after first interaction
            const welcome = document.querySelector('.welcome-message');
            if (welcome) {
                setTimeout(() => welcome.style.display = 'none', 3000);
            }
        }

        // Event listeners
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        messageInput.addEventListener('input', function() {
            if (this.value.trim()) {
                document.getElementById('sendButton').style.background = 'linear-gradient(135deg, #2E8B57 0%, #764ba2 100%)';
            } else {
                document.getElementById('sendButton').style.background = 'linear-gradient(135deg, #ccc 0%, #999 100%)';
            }
        });

        // Welcome interaction
        setTimeout(() => {
            addMessage("Hello! I'm your HeartoListen companion. I'm here to provide a safe space for you to share your thoughts and feelings. How are you doing today?", false);
        }, 1000);
    </script>
</body>
</html>
