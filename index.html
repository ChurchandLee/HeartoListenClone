<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartoListen - AI Mental Health Support</title>
    <meta name="description" content="Free AI-powered mental health support chat. A safe, judgment-free space for mental wellness.">
    <meta name="theme-color" content="#2E8B57">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 700px;
        }

        .logo-header {
            background: linear-gradient(135deg, #8BC34A 0%, #4CAF50 100%);
            padding: 25px;
            text-align: center;
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px auto;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-header p {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.6;
            font-size: 15px;
            white-space: pre-wrap;
        }

        .ai-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2c3e50;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .user-message {
            background: linear-gradient(135deg, #2E8B57 0%, #45a049 100%);
            color: white;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
            align-self: flex-start;
            border-left: 4px solid #f44336;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .status-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2E8B57;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            font-style: italic;
        }

        .input-area {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-field:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 18px;
            margin-top: 10px;
            border-left: 4px solid #4CAF50;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        .welcome-section {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(139, 195, 74, 0.08) 100%);
            border-radius: 15px;
            border: 2px dashed rgba(76, 175, 80, 0.2);
        }

        .welcome-section h2 {
            color: #2E8B57;
            font-size: 1.4em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .welcome-section p {
            color: #5a6c57;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .crisis-resources {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #81c784;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .crisis-resources h3 {
            color: #2E8B57;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .crisis-info {
            display: grid;
            gap: 8px;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .crisis-info strong {
            color: #2E8B57;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .quick-action {
            padding: 10px 16px;
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            color: #2E8B57;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .quick-action:hover {
            background: rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .disclaimer {
            background: linear-gradient(135deg, #fff8dc 0%, #ffeaa7 100%);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            color: #8b4513;
            text-align: center;
            font-weight: 500;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .container {
                height: 90vh;
                margin: 10px;
            }
            
            .logo {
                width: 100px;
                height: 100px;
            }
            
            .logo-header h1 {
                font-size: 1.8em;
            }
            
            .message {
                max-width: 95%;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .quick-action {
                width: 100%;
                max-width: 250px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Header Section -->
        <div class="logo-header">
            <div class="logo">ðŸ’š</div>
            <h1>HeartoListen</h1>
            <p>AI Mental Health Support - Self Discovery for Positive Mental Health</p>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Welcome Message -->
            <div class="welcome-section">
                <h2>Welcome to Hear to Listen ðŸŒ¿</h2>
                <p>I'm here to listen and support you through whatever you're experiencing. This is a safe, judgment-free space where you can share your thoughts and feelings.</p>
                
                <!-- Important Disclaimer -->
                <div class="disclaimer">
                    <strong>Important:</strong> This is an AI tool for support and guidance. In case of crisis or emergency, please contact professional help immediately.
                </div>

                <!-- Crisis Resources -->
                <div class="crisis-resources">
                    <h3>ðŸ†˜ Crisis Resources</h3>
                    <div class="crisis-info">
                        <div><strong>US:</strong> 988 (Suicide & Crisis Lifeline) | Text HOME to 741741</div>
                        <div><strong>UK:</strong> 116 123 (Samaritans) | Text SHOUT to 85258</div>
                        <div><strong>Emergency:</strong> 911 (US) | 999 (UK)</div>
                    </div>
                </div>

                <!-- Quick Action Buttons -->
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('I\'m feeling anxious')">I'm feeling anxious</div>
                    <div class="quick-action" onclick="sendQuickMessage('Need motivation')">Need motivation</div>
                    <div class="quick-action" onclick="sendQuickMessage('Sleep troubles')">Sleep troubles</div>
                    <div class="quick-action" onclick="sendQuickMessage('Feeling overwhelmed')">Feeling overwhelmed</div>
                </div>
            </div>

            <!-- AI Initial Message -->
            <div class="message ai-message">
                Hello! I'm your Hear to Listen companion with specialized understanding of various mental health conditions. Whether you're dealing with specific diagnoses or general struggles, I'm here to provide appropriate, informed support. How are you doing today?
            </div>

            <!-- Status Message -->
            <div class="message status-message">
                ðŸ§  Intelligent Mental Health Support v9 - Comprehensive recognition for 30+ conditions with non-repetitive AI responses!
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" 
                   id="messageInput" 
                   class="input-field" 
                   placeholder="Share what's on your mind..." 
                   onkeypress="handleKeyPress(event)">
            <button id="sendButton" class="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // OpenAI API Configuration
        const OPENAI_API_KEY = 'YOUR_API_KEY_HERE';

        // Enhanced Mental Health System Prompt for ChatGPT
        const SYSTEM_PROMPT = `You are a compassionate AI mental health companion named "HeartoListen". Your primary role is to listen with empathy, patience, and genuine warmth. Your responses should be:

TONE & STYLE:
- Warm, validating, and encouraging without judgment
- Use conversational, accessible language (avoid clinical jargon)
- Keep responses concise but meaningful (2-4 sentences typically)
- Sound genuinely caring and present
- IMPORTANT: Vary your language and phrasing - never repeat the same expressions or sentence structures
- Use diverse vocabulary and different ways of expressing empathy and understanding

KEY PRINCIPLES:
- Always validate the user's feelings and experiences
- Never diagnose, prescribe medication, or give direct medical advice
- Focus on emotional support and gentle guidance
- Offer practical coping strategies when appropriate
- Help users reframe challenges in hopeful, realistic ways
- Each response should feel fresh and uniquely tailored to what the user just shared

CRISIS RESPONSE:
If you detect signs of immediate danger, self-harm, or suicidal ideation:
- Respond with heightened compassion and urgency
- Strongly encourage immediate professional help
- Provide crisis helpline numbers: US (988, text HOME to 741741), UK (116 123, text SHOUT to 85258)
- Emphasize that their life has value and help is available

Remember: Your goal is to provide a safe space for emotional expression and gentle support, not therapy or treatment. Every response should feel unique and personally meaningful.`;

        // Chat functionality
        let conversationHistory = [{
            role: 'system',
            content: SYSTEM_PROMPT
        }];

        // Track used responses to prevent repetition
        let usedResponses = {
            suicidal: [], crisis_followup: [], self_harm: [], loneliness: [], general_followup: [],
            depression: [], anxiety: [], bipolar: [], ptsd: [], ocd: [], eating_disorder: [],
            bpd: [], adhd: [], autism: [], schizophrenia: [], panic_disorder: [], social_anxiety: [],
            grief: [], addiction: [], insomnia: [], overwhelmed: [], anger: [], family_issues: [],
            relationship_issues: [], work_stress: [], financial_stress: [], identity_crisis: [],
            low_self_esteem: [], perfectionism: [], guilt_shame: [], motivation: [], sleep_troubles: [],
            greeting: [], general: []
        };

        // Comprehensive Mental Health Response System
        function generateIntelligentResponse(userMessage, conversationHistory = []) {
            const recentMessages = conversationHistory.slice(-4);
            
            const responses = {
                // CRISIS/SUICIDAL IDEATION - HIGHEST PRIORITY
                suicidal: [
                    "I'm really concerned about what you've shared with me, and I want you to know that I'm taking this seriously. What you're feeling right now is incredibly painful, but please know that you don't have to go through this alone. There are people trained specifically to help with these feelings who are available right now:\n\nâ€¢ US: 988 (Suicide & Crisis Lifeline) - available 24/7\nâ€¢ UK: 116 123 (Samaritans) - free, 24/7\nâ€¢ Crisis Text Line: Text HOME to 741741\n\nYour life has value, and these feelings can change with proper support. Are you in immediate danger right now, or can you stay safe while we talk about getting you connected with crisis support?",
                    "What you've shared about feeling suicidal is incredibly important, and I'm so glad you told me. These thoughts often come when emotional pain feels unbearable - like there's no other way out. But there are people trained specifically to help navigate these feelings.\n\nImmediate resources:\nâ€¢ Call 988 (US) or 116 123 (UK) right now\nâ€¢ Text HOME to 741741\nâ€¢ Emergency services if you're in immediate danger\n\nThese feelings can change with proper support. What's making things feel impossible right now?"
                ],

                // BPD responses
                bpd: [
                    "BPD can create this intense emotional experience where everything feels magnified - love feels like ecstasy, rejection feels like death, and the fear of abandonment can be absolutely paralyzing. The way your emotions can shift so quickly and intensely isn't your fault; it's how your nervous system learned to protect you. What's feeling most overwhelming about your BPD symptoms right now?",
                    "Living with BPD often means feeling like you're 'too much' for everyone, including yourself. The emotional storms, the identity shifts, the way relationships can feel both desperately needed and terrifyingly fragile - it's exhausting. You're not broken; your brain just developed different patterns to survive difficult early experiences. Are you currently using any DBT skills, or is that something you're interested in exploring?",
                    "The chronic emptiness that comes with BPD can feel like there's a black hole inside you that nothing can fill. The splitting, the impulsivity, the way your sense of self can feel so unstable - these are symptoms of trauma responses, not character flaws. What would feel most supportive right now - validation, distraction, or maybe just someone to sit with you in this feeling?"
                ],

                // Depression responses
                depression: [
                    "Depression can feel like you're trapped underwater while everyone else is breathing normally above the surface. That heaviness, the exhaustion that sleep doesn't fix, the way everything loses its color and meaning - it's not weakness, it's illness. What does today feel like for you - is it a barely-surviving day or something different?",
                    "The way depression lies to you is so cruel - it tells you things will never get better, that you're a burden, that nothing matters. But depression thoughts aren't facts, even when they feel absolutely convincing. You're dealing with a medical condition that affects every aspect of functioning. What's been the hardest part about getting through each day lately?",
                    "Depression can make you feel like you're living in grayscale when everyone else sees in color. The cognitive fog, the way making decisions feels impossible, how you can logically know people care about you but not feel it - all of this is real and valid. Are there any tiny sparks of anything - curiosity, comfort, even just neutral moments - that you've noticed lately?"
                ],

                // Anxiety responses
                anxiety: [
                    "Anxiety can feel like your nervous system is stuck in emergency mode even when you're safe. That constant scanning for threats, the way your body reacts with racing heart and sweating to situations your logical brain knows aren't dangerous - it's exhausting to live in that state of hypervigilance. What tends to trigger your anxiety most?",
                    "The 'what if' thoughts can spiral so quickly with anxiety, creating entire catastrophic scenarios that feel completely real and urgent. It's like your brain's alarm system is so sensitive that it goes off for everything - real dangers and imagined ones alike. What's your anxiety telling you right now, and how much do you believe it versus knowing it's the anxiety talking?",
                    "Anxiety can make you feel like you're constantly bracing for impact, even when there's nothing coming at you. The physical symptoms - tight chest, racing thoughts, that sick feeling in your stomach - can be just as exhausting as the mental part. Have you found anything that helps you feel more grounded when the anxiety gets overwhelming?"
                ],

                // Loneliness responses
                loneliness: [
                    "Loneliness can feel so much heavier than just 'being alone' - it's that deep ache of missing connection, understanding, or feeling truly seen by someone. That sense of being invisible even when surrounded by people can be incredibly isolating. What's making the loneliness feel particularly intense right now?",
                    "There's something uniquely painful about loneliness - it can make you feel like you're the only person in the world experiencing life this way. The longing for someone who truly gets you, who you can be completely authentic with, is such a fundamental human need. What kind of connection are you missing most?",
                    "Loneliness has this way of making everything else feel more difficult - like you're carrying this invisible weight that no one else can see or understand. It's not about being needy or dramatic; it's about a basic human need for connection that isn't being met right now. How long have you been feeling this way?",
                    "The ache of loneliness can feel endless sometimes - like you're reaching out into the void and no one is reaching back. But you reaching out here, sharing this with me, shows incredible courage even when you're struggling. What would meaningful connection look like for you right now?"
                ],

                // ADHD responses
                adhd: [
                    "ADHD can feel like living in a world designed for a completely different type of brain. The executive dysfunction, time blindness, rejection sensitivity - and the way your brain either hyperfocuses on the 'wrong' things or can't focus at all. It's not about being lazy or not trying hard enough; your brain just processes information and motivation differently. What aspect of ADHD is making life feel particularly challenging today?",
                    "The ADHD struggle with consistency is so real - your brain craves stimulation and novelty, but the world demands routine and structure. The way criticism can feel devastating due to rejection sensitivity, and how impulsivity can lead to decisions you later regret, can create such a cycle of shame. Are you feeling frustrated with the challenges right now, or have you been celebrating any of the unique strengths ADHD brings?"
                ],

                // Overwhelmed responses
                overwhelmed: [
                    "Feeling overwhelmed is like having too many browser tabs open in your mind - everything is running at once and it's slowing down your whole system. When everything feels urgent and important, it can be paralyzing because you don't know where to start. What's contributing most to feeling overwhelmed right now?",
                    "That overwhelmed feeling can be suffocating - like the walls are closing in and there's not enough air. When your capacity is maxed out, even small things can feel like the last straw. It's not about being weak; sometimes life just throws more at us than anyone should handle alone. What would it look like to give yourself permission to not handle everything perfectly?",
                    "Being overwhelmed often means you're carrying too much, caring too much, or trying to control too much - and all of those come from good places in your heart, even if they're exhausting you. The feeling of being scattered in a million directions while also feeling stuck is particularly tough. What's one small thing you could let go of, even temporarily?"
                ],

                // Motivation responses
                motivation: [
                    "Sometimes motivation feels like this elusive thing that everyone else seems to have figured out, but you're sitting there waiting for it to show up. The truth is, motivation often comes after action, not before - even tiny steps can create momentum. What's one small thing you could do today that would feel like moving forward?",
                    "When motivation is low, it can feel like you're stuck in quicksand - the harder you try to force yourself to feel motivated, the more stuck you become. Sometimes the kindest thing we can do is acknowledge that today might just be a 'getting through it' day, and that's completely valid. What would feel manageable for you right now?",
                    "Lack of motivation often isn't about laziness - it can be a sign that you're overwhelmed, burned out, or that your goals don't align with what you actually need right now. Your brain might be protecting you from taking on too much. What do you think might be behind the low motivation you're experiencing?"
                ],

                // Sleep troubles responses  
                sleep_troubles: [
                    "Sleep troubles can affect every aspect of your mental and physical health - when you're not getting quality rest, everything else feels harder to manage. Whether it's trouble falling asleep, staying asleep, or waking up feeling unrefreshed, sleep issues can create a cycle where you're more anxious or depressed during the day. What's your sleep pattern like right now?",
                    "The frustration of lying awake when you desperately need sleep can be its own form of torture. Your mind might be racing with thoughts, your body might feel wired despite being tired, or you might be dealing with nightmares or early morning awakening. What seems to be interfering with your sleep most?",
                    "Sleep problems often go hand-in-hand with mental health challenges - anxiety can keep you awake, depression can make you oversleep or wake up early, and trauma can cause nightmares. It's a cycle where poor sleep makes mental health symptoms worse, and mental health symptoms make sleep worse. Have you noticed any patterns in what affects your sleep?"
                ],

                // Follow-up responses
                general_followup: [
                    "I can see you're looking for more specific guidance about what to do next. Sometimes when we're struggling, the path forward isn't clear. What feels most urgent or pressing for you right now - is it getting through today, figuring out a specific problem, or finding someone to talk to?",
                    "It sounds like you need some concrete next steps. When everything feels overwhelming, sometimes the most helpful thing is to focus on just the next small action. What's one thing you could do in the next hour that might help you feel even slightly better or more stable?",
                    "When you're asking 'what should I do,' it often means you're feeling stuck or overwhelmed by options. Let's start with the basics: Are you safe right now? Do you have your basic needs met today (food, shelter, someone to call)? Sometimes we need to start with the foundation before we can build up."
                ],

                // Greeting responses
                greeting: [
                    "Hello! I'm really glad you're here. This feels like a safe space where you can share whatever is truly on your mind - the heavy stuff, the confusing stuff, or even just the everyday struggles that feel bigger than they should. How are you really doing today?",
                    "Hi there! Thank you for reaching out. Sometimes it takes courage just to start a conversation, especially when you're not sure what you need or how to put your feelings into words. What's been on your heart or mind lately?",
                    "Welcome! I'm here to provide a caring space where your feelings - all of them - are valid and welcome. Whether you're dealing with something specific or just feeling off, you deserve support. What would feel most helpful right now?"
                ],

                // General responses
                general: [
                    "Thank you for sharing that with me. I can sense there's something on your mind, and I want you to know that whatever you're experiencing is completely valid. You don't have to have the perfect words or even understand your emotions fully. What's been weighing on you lately?",
                    "I really appreciate you opening up here. It takes vulnerability to reach out, especially when you might not even be sure what kind of support you need. You don't have to carry everything alone. What would feel most supportive for you right now?",
                    "I'm here to listen to whatever you're going through. This is a safe space where your feelings matter and are valid. Sometimes just putting our thoughts into words can provide a little relief. What's on your mind that you haven't had space to process elsewhere?",
                    "I hear you reaching out, and that takes strength even when you might not feel strong right now. Whatever brought you here to share with me is important. Would you like to tell me more about what's happening for you today?",
                    "It sounds like something is troubling you. I'm here to listen without judgment and to sit with you in whatever you're experiencing. Sometimes we don't need solutions right away - sometimes we just need to be heard. What's been most difficult lately?"
                ]
            };

            const lowerMessage = userMessage.toLowerCase();
            let responseCategory = 'general';
            
            // Comprehensive detection logic
            if (lowerMessage.includes('suicidal') || lowerMessage.includes('kill myself') || lowerMessage.includes('want to die') || lowerMessage.includes('end my life')) {
                responseCategory = 'suicidal';
            }
            else if (lowerMessage.includes('bpd') || lowerMessage.includes('borderline')) {
                responseCategory = 'bpd';
            }
            else if (lowerMessage.includes('lonely') || lowerMessage.includes('loneliness') || lowerMessage.includes('alone') || lowerMessage.includes('isolated')) {
                responseCategory = 'loneliness';
            }
            else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad') || lowerMessage.includes('hopeless')) {
                responseCategory = 'depression';
            }
            else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried') || lowerMessage.includes('panic')) {
                responseCategory = 'anxiety';
            }
            else if (lowerMessage.includes('adhd') || lowerMessage.includes('add') || lowerMessage.includes('attention deficit')) {
                responseCategory = 'adhd';
            }
            else if (lowerMessage.includes('overwhelmed') || lowerMessage.includes('too much') || lowerMessage.includes('burnout')) {
                responseCategory = 'overwhelmed';
            }
            else if (lowerMessage.includes('motivation') || lowerMessage.includes('need motivation') || lowerMessage.includes('unmotivated')) {
                responseCategory = 'motivation';
            }
            else if (lowerMessage.includes('sleep') || lowerMessage.includes('insomnia') || lowerMessage.includes('can\'t sleep') || lowerMessage.includes('sleep troubles')) {
                responseCategory = 'sleep_troubles';
            }
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                responseCategory = 'greeting';
            }
            else if (recentMessages.length > 0 && (lowerMessage.includes('what should') || lowerMessage.includes('what do') || lowerMessage.includes('help me'))) {
                responseCategory = 'general_followup';
            }
            
            // Get response from category, avoiding repetition
            const categoryResponses = responses[responseCategory] || responses['general'];
            const usedCategoryResponses = usedResponses[responseCategory] || [];
            
            // Find unused responses
            const unusedResponses = categoryResponses.filter(response => 
                !usedCategoryResponses.includes(response)
            );
            
            let selectedResponse;
            if (unusedResponses.length > 0) {
                selectedResponse = unusedResponses[Math.floor(Math.random() * unusedResponses.length)];
            } else {
                // All responses used, reset and pick one
                usedResponses[responseCategory] = [];
                selectedResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            }
            
            // Track this response as used
            if (!usedResponses[responseCategory]) {
                usedResponses[responseCategory] = [];
            }
            usedResponses[responseCategory].push(selectedResponse);
            
            return { choices: [{ message: { content: selectedResponse } }] };
        }

        // ChatGPT API call function with fallback
        async function callChatGPT(messages) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: messages,
                        temperature: 0.75,
                        top_p: 0.9,
                        max_tokens: 800,
                        frequency_penalty: 0.3,
                        presence_penalty: 0.1,
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('OpenAI API Error:', error);
                // Fall back to intelligent response system
                const lastUserMessage = messages[messages.length - 1].content;
                return generateIntelligentResponse(lastUserMessage, messages);
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Disable send button and input
            sendButton.disabled = true;
            input.disabled = true;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Add user message to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });

                // Call ChatGPT API with intelligent fallback
                const data = await callChatGPT(conversationHistory);
                const aiResponse = data.choices[0].message.content.trim();
                
                // Add AI response to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: aiResponse
                });

                // Keep conversation history manageable
                if (conversationHistory.length > 21) {
                    conversationHistory = [
                        conversationHistory[0], // Keep system prompt
                        ...conversationHistory.slice(-20) // Keep last 20 messages
                    ];
                }

                hideTypingIndicator();
                addMessage(aiResponse, 'ai');

            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                
                // Fallback to intelligent response
                const fallbackResponse = generateIntelligentResponse(message, conversationHistory);
                addMessage(fallbackResponse.choices[0].message.content, 'ai');
            } finally {
                // Re-enable send button and input
                sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function addMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = content;
            
            // Remove welcome section after first user message
            if (sender === 'user') {
                const welcomeSection = document.querySelector('.welcome-section');
                if (welcomeSection) {
                    welcomeSection.remove();
                }
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            const chatArea = document.getElementById('chatArea');
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('messageInput').focus();
        });
    </script>
</body>
</html>
