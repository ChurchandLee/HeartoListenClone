<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartoListen - AI Mental Health Support</title>
    <meta name="description" content="Free AI-powered mental health support chat. A safe, judgment-free space for mental wellness.">
    <meta name="theme-color" content="#2E8B57">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 700px;
        }

        .logo-header {
            background: linear-gradient(135deg, #8BC34A 0%, #4CAF50 100%);
            padding: 25px;
            text-align: center;
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px auto;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-header p {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.6;
            font-size: 15px;
            white-space: pre-wrap;
        }

        .ai-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2c3e50;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .user-message {
            background: linear-gradient(135deg, #2E8B57 0%, #45a049 100%);
            color: white;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
            align-self: flex-start;
            border-left: 4px solid #f44336;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .status-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2E8B57;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            font-style: italic;
        }

        .input-area {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-field:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 18px;
            margin-top: 10px;
            border-left: 4px solid #4CAF50;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        .welcome-section {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(139, 195, 74, 0.08) 100%);
            border-radius: 15px;
            border: 2px dashed rgba(76, 175, 80, 0.2);
        }

        .welcome-section h2 {
            color: #2E8B57;
            font-size: 1.4em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .welcome-section p {
            color: #5a6c57;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .crisis-resources {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #81c784;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .crisis-resources h3 {
            color: #2E8B57;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .crisis-info {
            display: grid;
            gap: 8px;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .crisis-info strong {
            color: #2E8B57;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .quick-action {
            padding: 10px 16px;
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            color: #2E8B57;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .quick-action:hover {
            background: rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .disclaimer {
            background: linear-gradient(135deg, #fff8dc 0%, #ffeaa7 100%);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            color: #8b4513;
            text-align: center;
            font-weight: 500;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .container {
                height: 90vh;
                margin: 10px;
            }
            
            .logo {
                width: 100px;
                height: 100px;
            }
            
            .logo-header h1 {
                font-size: 1.8em;
            }
            
            .message {
                max-width: 95%;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .quick-action {
                width: 100%;
                max-width: 250px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Header Section -->
        <div class="logo-header">
            <div class="logo">ðŸ’š</div>
            <h1>HeartoListen</h1>
            <p>AI Mental Health Support - Self Discovery for Positive Mental Health</p>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Welcome Message -->
            <div class="welcome-section">
                <h2>Welcome to Hear to Listen ðŸŒ¿</h2>
                <p>I'm here to listen and support you through whatever you're experiencing. This is a safe, judgment-free space where you can share your thoughts and feelings.</p>
                
                <!-- Important Disclaimer -->
                <div class="disclaimer">
                    <strong>Important:</strong> This is an AI tool for support and guidance. In case of crisis or emergency, please contact professional help immediately.
                </div>

                <!-- Crisis Resources -->
                <div class="crisis-resources">
                    <h3>ðŸ†˜ Crisis Resources</h3>
                    <div class="crisis-info">
                        <div><strong>US:</strong> 988 (Suicide & Crisis Lifeline) | Text HOME to 741741</div>
                        <div><strong>UK:</strong> 116 123 (Samaritans) | Text SHOUT to 85258</div>
                        <div><strong>Emergency:</strong> 911 (US) | 999 (UK)</div>
                    </div>
                </div>

                <!-- Quick Action Buttons -->
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('I\'m feeling anxious')">I'm feeling anxious</div>
                    <div class="quick-action" onclick="sendQuickMessage('Need motivation')">Need motivation</div>
                    <div class="quick-action" onclick="sendQuickMessage('Sleep troubles')">Sleep troubles</div>
                    <div class="quick-action" onclick="sendQuickMessage('Feeling overwhelmed')">Feeling overwhelmed</div>
                </div>
            </div>

            <!-- AI Initial Message -->
            <div class="message ai-message">
                Hello! I'm your Hear to Listen companion with specialized understanding of various mental health conditions. Whether you're dealing with specific diagnoses or general struggles, I'm here to provide appropriate, informed support. How are you doing today?
            </div>

            <!-- Status Message -->
            <div class="message status-message">
                ðŸ§  Intelligent Mental Health Support - Specialized responses for different conditions with ChatGPT 4.0 integration!
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" 
                   id="messageInput" 
                   class="input-field" 
                   placeholder="Share what's on your mind..." 
                   onkeypress="handleKeyPress(event)">
            <button id="sendButton" class="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // OpenAI API Configuration - Will be replaced by GitHub Actions with secret
        const OPENAI_API_KEY = 'YOUR_API_KEY_HERE';

        // Mental Health System Prompt for ChatGPT
        const SYSTEM_PROMPT = `You are a compassionate AI mental health companion named "HeartoListen". Your primary role is to listen with empathy, patience, and genuine warmth. Your responses should be:

TONE & STYLE:
- Warm, validating, and encouraging without judgment
- Use conversational, accessible language (avoid clinical jargon)
- Keep responses concise but meaningful (2-4 sentences typically)
- Sound genuinely caring and present

KEY PRINCIPLES:
- Always validate the user's feelings and experiences
- Never diagnose, prescribe medication, or give direct medical advice
- Focus on emotional support and gentle guidance
- Offer practical coping strategies when appropriate
- Help users reframe challenges in hopeful, realistic ways

CRISIS RESPONSE:
If you detect signs of immediate danger, self-harm, or suicidal ideation:
- Respond with heightened compassion and urgency
- Strongly encourage immediate professional help
- Provide crisis helpline numbers: US (988, text HOME to 741741), UK (116 123, text SHOUT to 85258)
- Emphasize that their life has value and help is available

INTERACTION STYLE:
- Ask gentle, open-ended questions to encourage reflection
- Reflect back what you hear to show understanding
- Prioritize emotional safety over problem-solving
- Use brief paragraphs for readability
- Make the user feel heard, valued, and hopeful

Remember: Your goal is to provide a safe space for emotional expression and gentle support, not therapy or treatment.`;

        // Chat functionality
        let conversationHistory = [{
            role: 'system',
            content: SYSTEM_PROMPT
        }];

        // Enhanced Mental Health Response System with Condition-Specific Support
        function generateIntelligentResponse(userMessage) {
            const responses = {
                // BPD (Borderline Personality Disorder) specific responses
                bpd: [
                    "Living with BPD can feel like being on an emotional rollercoaster that you can't control. The intense emotions and fear of abandonment are real parts of your experience, not character flaws. DBT skills like distress tolerance and emotion regulation can be really helpful. Are you currently working with a therapist who understands BPD?",
                    "BPD can make relationships feel incredibly intense and frightening at the same time. The push-pull feelings and fear of being left can be exhausting. Remember that your emotions are valid, even when they feel overwhelming. What's been the most challenging part of managing your BPD symptoms lately?",
                    "I understand that BPD can make every emotion feel amplified and every relationship feel precarious. The splitting and intense mood swings aren't your fault - they're symptoms of a condition that you're managing. Have you found any grounding techniques that help during particularly difficult moments?"
                ],
                
                // ADHD specific responses
                adhd: [
                    "ADHD can make daily life feel like you're constantly swimming upstream - your brain works differently, not defectively. The struggles with focus, organization, and impulse control are neurological, not personal failings. What aspects of ADHD are impacting you most right now?",
                    "Living with ADHD often means dealing with a world that wasn't designed for how your brain works. The executive function challenges, time blindness, and emotional dysregulation are real parts of ADHD that many people don't understand. Are you finding strategies that work with your brain rather than against it?",
                    "ADHD can feel like having a race car brain with bicycle brakes sometimes. The hyperfocus and scattered attention, the rejection sensitivity - these are all valid experiences. Remember that ADHD also comes with creativity, enthusiasm, and unique problem-solving abilities. How are you managing the more challenging symptoms?"
                ],
                
                // Depression specific responses
                depression: [
                    "Depression can make everything feel impossibly heavy, like you're carrying a weight that no one else can see. The exhaustion, hopelessness, and loss of interest in things you used to enjoy - these are symptoms of an illness, not personal weaknesses. What's been the hardest part about getting through each day?",
                    "I hear that you're struggling with depression, and I want you to acknowledge how much strength it takes just to keep going when your brain is telling you that nothing matters. Depression lies to us about our worth and our future. Are you getting any professional support for what you're experiencing?",
                    "Depression can feel like being trapped underwater while everyone else is breathing normally. The cognitive symptoms - difficulty concentrating, making decisions, remembering things - are just as real as the emotional pain. What small things, if any, have given you even moments of relief?"
                ],
                
                // Anxiety disorders
                anxiety_disorders: [
                    "Anxiety disorders can make your mind feel like it's constantly preparing for disasters that may never come. The physical symptoms - racing heart, sweating, difficulty breathing - are your nervous system's real response to perceived threats. What triggers tend to set off your anxiety most?",
                    "Living with an anxiety disorder often means your brain's alarm system is stuck in the 'on' position. The constant worry, the what-if scenarios, the avoidance - these are protective mechanisms that have become overactive. Are you working with any specific anxiety management techniques?",
                    "Anxiety disorders can make normal situations feel like life-or-death scenarios. The anticipatory anxiety, panic attacks, and safety behaviors are your mind's attempt to protect you, even when they're not helpful. What situations feel most overwhelming for you right now?"
                ],
                
                // Bipolar disorder
                bipolar: [
                    "Bipolar disorder can feel like living with two different versions of yourself - the extremes of mania and depression can be disorienting and exhausting. The mood cycles, energy changes, and impact on relationships are significant challenges. Are you currently stable on medication, or are you still finding what works?",
                    "Managing bipolar disorder often means becoming an expert on your own patterns and triggers. The hypomanic or manic episodes might feel good in the moment but can have consequences, while the depressive episodes can feel crushing. What's been most helpful for you in managing mood episodes?",
                    "Bipolar disorder requires a lot of self-awareness and ongoing management. The unpredictability of mood episodes and their impact on work, relationships, and daily functioning is exhausting. How are you doing with recognizing early warning signs of mood changes?"
                ],
                
                // PTSD/Trauma responses
                ptsd_trauma: [
                    "Trauma can rewire how your brain and body respond to the world, making you hypervigilant and reactive in ways that once helped you survive. Flashbacks, nightmares, and emotional numbing are normal responses to abnormal experiences. Are you in a safe place now to begin processing what you've been through?",
                    "PTSD symptoms like intrusive thoughts, avoidance, and being easily startled are your nervous system's way of trying to protect you from further harm. Trauma therapy approaches like EMDR or trauma-focused CBT can be really effective. What feels most challenging about your trauma symptoms right now?",
                    "Living with trauma means your body and mind remember danger even when you're safe now. The hypervigilance, sleep disturbances, and difficulty trusting others make sense given what you've experienced. Have you found any grounding techniques that help when you're triggered?"
                ],
                
                // OCD specific responses
                ocd: [
                    "OCD can feel like being trapped in a cycle where your brain convinces you that something terrible will happen unless you perform certain actions or think certain thoughts. The intrusive thoughts and compulsions aren't reflections of who you are as a person. Are you working with exposure and response prevention therapy?",
                    "Living with OCD means dealing with thoughts that feel incredibly real and urgent, even when the logical part of your brain knows they don't make sense. The time consumed by rituals and the distress when you can't complete them is exhausting. What themes do your obsessions typically focus on?",
                    "OCD can make you feel like you're not in control of your own mind - the intrusive thoughts, the doubt, the need for certainty or symmetry. Remember that having these thoughts doesn't make you a bad person; they're symptoms of a condition that responds well to treatment. How are you managing the compulsive behaviors?"
                ],
                
                // Eating disorders
                eating_disorders: [
                    "Eating disorders are complex mental health conditions that use food, weight, and body image as ways to cope with difficult emotions and situations. The behaviors around food often feel necessary for control or safety, even when they're harmful. Are you getting specialized eating disorder treatment?",
                    "Recovery from an eating disorder means learning to trust your body again and finding new ways to cope with emotions that don't involve food restriction, binging, or purging. The process is challenging and non-linear. What feels most difficult about your relationship with food right now?",
                    "Eating disorders can make you feel like food and your body are the enemy, when really they're symptoms of deeper emotional pain. The shame and secrecy that often accompany these disorders can be isolating. How are you taking care of your physical health while addressing the underlying issues?"
                ],
                
                // General anxiety
                anxiety: [
                    "I hear that you're feeling anxious, and I want you to know that what you're experiencing is completely valid. Anxiety can feel overwhelming, but you're not alone in this. One technique that many people find helpful is the 5-4-3-2-1 grounding method - can you name 5 things you can see right now?",
                    "Anxiety can make everything feel so much more intense and scary than it really is. That's just what anxiety does - it's not a reflection of your strength or capability. Try taking some slow, deep breaths with me. What's one small thing that usually brings you a bit of comfort?",
                    "Thank you for sharing that you're feeling anxious. It takes courage to acknowledge these feelings. Sometimes when anxiety hits, our mind races with 'what if' scenarios. Remember that anxious thoughts aren't facts. What's been weighing most heavily on your mind lately?"
                ],
                
                // General depression
                depression_general: [
                    "I can hear the heaviness in what you're sharing, and I want you to know that I'm here with you in this difficult moment. Depression can make everything feel so much harder, but you're brave for reaching out. What's been the most challenging part of how you're feeling?",
                    "It takes real strength to talk about feeling depressed. When we're in that dark place, it can feel like things will never get better, but feelings do change and shift, even when it doesn't seem possible. What's one tiny thing that used to bring you even a small moment of peace?",
                    "Depression can be like looking at the world through dark-tinted glasses - everything seems harder and more hopeless. But you're still here, still reaching out, and that matters more than you know. How long have you been carrying these heavy feelings?"
                ],
                
                // Other categories remain the same...
                stress: [
                    "It sounds like you're dealing with a lot of stress right now. When everything feels overwhelming, sometimes it helps to remember that you don't have to solve everything at once. What feels like the most pressing thing on your mind today?",
                    "Stress can make us feel like we're being pulled in a million directions. That's such a heavy feeling to carry. Sometimes breaking things down into smaller, manageable pieces can help. What's one small step you could take today?",
                    "I can hear that stress is really weighing on you. It's completely understandable to feel overwhelmed when life throws a lot at us. What kind of support would feel most helpful to you right now?"
                ],
                
                sleep: [
                    "Sleep troubles can affect everything - your mood, energy, and ability to cope with daily challenges. It's so frustrating when you need rest but can't seem to get it. Are there particular thoughts or worries that tend to surface when you're trying to sleep?",
                    "Not getting good sleep makes everything feel more difficult, doesn't it? Your mind and body need that time to recharge. Have you noticed any patterns in what might be keeping you awake? Sometimes talking through what's on our minds can help.",
                    "Sleep issues can be really draining both physically and emotionally. It's like being tired but your mind won't let you rest. What does your bedtime routine look like? Sometimes small changes can make a big difference."
                ],
                
                motivation: [
                    "Feeling unmotivated is actually really common, especially when we're going through tough times. It doesn't mean anything is wrong with you. Sometimes motivation follows action rather than the other way around. What's one very small thing you could do today?",
                    "I hear that you're struggling to find motivation right now. That can be really frustrating when you know there are things you want or need to do. What usually helps you feel more energized or purposeful, even if those things don't feel appealing right now?",
                    "Lack of motivation can feel so heavy and discouraging. You're not alone in feeling this way. Sometimes acknowledging the small things we do accomplish, even getting through the day, is worth recognizing. What's something small you've done recently that you can give yourself credit for?"
                ],
                
                greeting: [
                    "Hello! I'm so glad you're here. This is a safe space where you can share whatever is on your mind. How are you feeling today?",
                    "Hi there! Thank you for reaching out. I'm here to listen and support you through whatever you're experiencing. What would you like to talk about?",
                    "Welcome! I'm here to provide a caring space for you to express your thoughts and feelings. How can I support you today?"
                ],
                
                general: [
                    "Thank you for sharing that with me. I can sense that there's a lot on your mind right now. Your feelings are completely valid, and I'm glad you felt comfortable opening up here. What would feel most supportive for you in this moment?",
                    "I really appreciate you trusting me with your thoughts and feelings. It takes courage to reach out, especially when things feel heavy. You don't have to carry everything alone. What's been weighing most on your heart lately?",
                    "I'm here to listen to whatever you're going through. This is a safe space where your feelings matter and are valid. Sometimes just putting our thoughts into words can provide a little relief. How are you taking care of yourself right now?",
                    "It sounds like you're dealing with quite a bit. I want you to know that whatever you're feeling is okay - there's no right or wrong way to feel. What kind of support feels most helpful to you today?",
                    "I can hear that there's something important you want to share. I'm here to listen without judgment and walk alongside you through whatever you're facing. What's on your mind?"
                ]
            };

            const lowerMessage = userMessage.toLowerCase();
            let responseCategory = 'general';
            
            // Detect specific mental health conditions first
            if (lowerMessage.includes('bpd') || lowerMessage.includes('borderline personality') || lowerMessage.includes('borderline disorder')) {
                responseCategory = 'bpd';
            } else if (lowerMessage.includes('adhd') || lowerMessage.includes('attention deficit') || lowerMessage.includes('add ')) {
                responseCategory = 'adhd';
            } else if (lowerMessage.includes('bipolar') || lowerMessage.includes('manic') || lowerMessage.includes('hypomania')) {
                responseCategory = 'bipolar';
            } else if (lowerMessage.includes('ptsd') || lowerMessage.includes('trauma') || lowerMessage.includes('flashback') || lowerMessage.includes('triggered')) {
                responseCategory = 'ptsd_trauma';
            } else if (lowerMessage.includes('ocd') || lowerMessage.includes('obsessive') || lowerMessage.includes('compulsive') || lowerMessage.includes('intrusive thoughts')) {
                responseCategory = 'ocd';
            } else if (lowerMessage.includes('eating disorder') || lowerMessage.includes('anorexia') || lowerMessage.includes('bulimia') || lowerMessage.includes('binge eating')) {
                responseCategory = 'eating_disorders';
            } else if (lowerMessage.includes('panic disorder') || lowerMessage.includes('social anxiety') || lowerMessage.includes('generalized anxiety') || lowerMessage.includes('agoraphobia')) {
                responseCategory = 'anxiety_disorders';
            }
            // Then check for general symptoms and greetings
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey') || lowerMessage.match(/^(good morning|good afternoon|good evening)/)) {
                responseCategory = 'greeting';
            } else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried') || lowerMessage.includes('panic') || lowerMessage.includes('nervous')) {
                responseCategory = 'anxiety';
            } else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad') || lowerMessage.includes('hopeless') || lowerMessage.includes('down') || lowerMessage.includes('empty')) {
                responseCategory = 'depression_general';
            } else if (lowerMessage.includes('stressed') || lowerMessage.includes('overwhelmed') || lowerMessage.includes('pressure') || lowerMessage.includes('too much') || lowerMessage.includes('burden')) {
                responseCategory = 'stress';
            } else if (lowerMessage.includes('sleep') || lowerMessage.includes('insomnia') || lowerMessage.includes('tired') || lowerMessage.includes('exhausted') || lowerMessage.includes('can\'t sleep')) {
                responseCategory = 'sleep';
            } else if (lowerMessage.includes('motivation') || lowerMessage.includes('motivated') || lowerMessage.includes('stuck') || lowerMessage.includes('energy') || lowerMessage.includes('lazy')) {
                responseCategory = 'motivation';
            }
            
            // Get random response from category
            const categoryResponses = responses[responseCategory];
            const response = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            
            return { choices: [{ message: { content: response } }] };
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Disable send button and input
            sendButton.disabled = true;
            input.disabled = true;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Add user message to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });

                // Call ChatGPT 4.0 API with intelligent fallback
                const data = await callChatGPT(conversationHistory);
                const aiResponse = data.choices[0].message.content.trim();
                
                // Add AI response to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: aiResponse
                });

                // Keep conversation history manageable (last 20 messages + system prompt)
                if (conversationHistory.length > 21) {
                    conversationHistory = [
                        conversationHistory[0], // Keep system prompt
                        ...conversationHistory.slice(-20) // Keep last 20 messages
                    ];
                }

                hideTypingIndicator();
                addMessage(aiResponse, 'ai');

            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                
                // Fallback to intelligent response if everything fails
                const fallbackResponse = generateIntelligentResponse(message);
                addMessage(fallbackResponse.choices[0].message.content, 'ai');
            } finally {
                // Re-enable send button and input
                sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function addMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = content;
            
            // Remove welcome section after first user message
            if (sender === 'user') {
                const welcomeSection = document.querySelector('.welcome-section');
                if (welcomeSection) {
                    welcomeSection.remove();
                }
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            const chatArea = document.getElementById('chatArea');
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on input field when page loads
            document.getElementById('messageInput').focus();
        });
    </script>
</body>
</html>
