<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartoListen - AI Mental Health Support</title>
    <meta name="description" content="Free AI-powered mental health support chat. A safe, judgment-free space for mental wellness.">
    <meta name="theme-color" content="#2E8B57">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 700px;
        }

        .logo-header {
            background: linear-gradient(135deg, #8BC34A 0%, #4CAF50 100%);
            padding: 25px;
            text-align: center;
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px auto;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-header p {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.6;
            font-size: 15px;
            white-space: pre-wrap;
        }

        .ai-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2c3e50;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .user-message {
            background: linear-gradient(135deg, #2E8B57 0%, #45a049 100%);
            color: white;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
            align-self: flex-start;
            border-left: 4px solid #f44336;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .status-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2E8B57;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            font-style: italic;
        }

        .input-area {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-field:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 18px;
            margin-top: 10px;
            border-left: 4px solid #4CAF50;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        .welcome-section {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(139, 195, 74, 0.08) 100%);
            border-radius: 15px;
            border: 2px dashed rgba(76, 175, 80, 0.2);
        }

        .welcome-section h2 {
            color: #2E8B57;
            font-size: 1.4em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .welcome-section p {
            color: #5a6c57;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .crisis-resources {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #81c784;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .crisis-resources h3 {
            color: #2E8B57;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .crisis-info {
            display: grid;
            gap: 8px;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .crisis-info strong {
            color: #2E8B57;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .quick-action {
            padding: 10px 16px;
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            color: #2E8B57;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .quick-action:hover {
            background: rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .disclaimer {
            background: linear-gradient(135deg, #fff8dc 0%, #ffeaa7 100%);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            color: #8b4513;
            text-align: center;
            font-weight: 500;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .container {
                height: 90vh;
                margin: 10px;
            }
            
            .logo {
                width: 100px;
                height: 100px;
            }
            
            .logo-header h1 {
                font-size: 1.8em;
            }
            
            .message {
                max-width: 95%;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .quick-action {
                width: 100%;
                max-width: 250px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Header Section -->
        <div class="logo-header">
            <div class="logo">ðŸ’š</div>
            <h1>HeartoListen</h1>
            <p>AI Mental Health Support - Self Discovery for Positive Mental Health</p>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Welcome Message -->
            <div class="welcome-section">
                <h2>Welcome to Hear to Listen ðŸŒ¿</h2>
                <p>I'm here to listen and support you through whatever you're experiencing. This is a safe, judgment-free space where you can share your thoughts and feelings.</p>
                
                <!-- Important Disclaimer -->
                <div class="disclaimer">
                    <strong>Important:</strong> This is an AI tool for support and guidance. In case of crisis or emergency, please contact professional help immediately.
                </div>

                <!-- Crisis Resources -->
                <div class="crisis-resources">
                    <h3>ðŸ†˜ Crisis Resources</h3>
                    <div class="crisis-info">
                        <div><strong>US:</strong> 988 (Suicide & Crisis Lifeline) | Text HOME to 741741</div>
                        <div><strong>UK:</strong> 116 123 (Samaritans) | Text SHOUT to 85258</div>
                        <div><strong>Emergency:</strong> 911 (US) | 999 (UK)</div>
                    </div>
                </div>

                <!-- Quick Action Buttons -->
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('I\'m feeling anxious')">I'm feeling anxious</div>
                    <div class="quick-action" onclick="sendQuickMessage('Need motivation')">Need motivation</div>
                    <div class="quick-action" onclick="sendQuickMessage('Sleep troubles')">Sleep troubles</div>
                    <div class="quick-action" onclick="sendQuickMessage('Feeling overwhelmed')">Feeling overwhelmed</div>
                </div>
            </div>

            <!-- AI Initial Message -->
            <div class="message ai-message">
                Hello! I'm your Hear to Listen companion with specialized understanding of various mental health conditions. Whether you're dealing with specific diagnoses or general struggles, I'm here to provide appropriate, informed support. How are you doing today?
            </div>

            <!-- Status Message -->
            <div class="message status-message">
                ðŸ§  Intelligent Mental Health Support v8 - Comprehensive recognition for 25+ conditions with ChatGPT 5.0 integration!
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" 
                   id="messageInput" 
                   class="input-field" 
                   placeholder="Share what's on your mind..." 
                   onkeypress="handleKeyPress(event)">
            <button id="sendButton" class="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // OpenAI API Configuration
        const OPENAI_API_KEY = 'YOUR_API_KEY_HERE';

        // Enhanced Mental Health System Prompt for ChatGPT
        const SYSTEM_PROMPT = `You are a compassionate AI mental health companion named "HeartoListen". Your primary role is to listen with empathy, patience, and genuine warmth. Your responses should be:

TONE & STYLE:
- Warm, validating, and encouraging without judgment
- Use conversational, accessible language (avoid clinical jargon)
- Keep responses concise but meaningful (2-4 sentences typically)
- Sound genuinely caring and present
- IMPORTANT: Vary your language and phrasing - never repeat the same expressions or sentence structures
- Use diverse vocabulary and different ways of expressing empathy and understanding

KEY PRINCIPLES:
- Always validate the user's feelings and experiences
- Never diagnose, prescribe medication, or give direct medical advice
- Focus on emotional support and gentle guidance
- Offer practical coping strategies when appropriate
- Help users reframe challenges in hopeful, realistic ways
- Each response should feel fresh and uniquely tailored to what the user just shared

CRISIS RESPONSE:
If you detect signs of immediate danger, self-harm, or suicidal ideation:
- Respond with heightened compassion and urgency
- Strongly encourage immediate professional help
- Provide crisis helpline numbers: US (988, text HOME to 741741), UK (116 123, text SHOUT to 85258)
- Emphasize that their life has value and help is available

INTERACTION STYLE:
- Ask gentle, open-ended questions to encourage reflection
- Reflect back what you hear to show understanding
- Prioritize emotional safety over problem-solving
- Use brief paragraphs for readability
- Make the user feel heard, valued, and hopeful
- Avoid repetitive phrases like "I hear you" or "That sounds really difficult" in every response
- Mix up your conversation starters and empathetic expressions

RESPONSE VARIETY:
- Use different sentence structures and vocabulary in each response
- Avoid formulaic responses - make each one feel personally crafted
- Draw from a rich vocabulary of empathetic and supportive language
- Reference specific details the user mentions to show you're truly listening

Remember: Your goal is to provide a safe space for emotional expression and gentle support, not therapy or treatment. Every response should feel unique and personally meaningful.`;

        // Chat functionality
        let conversationHistory = [{
            role: 'system',
            content: SYSTEM_PROMPT
        }];

        // Track used responses to prevent repetition
        let usedResponses = {
            suicidal: [], crisis_followup: [], self_harm: [], loneliness: [], general_followup: [],
            depression: [], anxiety: [], bipolar: [], ptsd: [], ocd: [], eating_disorder: [],
            bpd: [], adhd: [], autism: [], schizophrenia: [], panic_disorder: [], social_anxiety: [],
            grief: [], addiction: [], insomnia: [], overwhelmed: [], anger: [], family_issues: [],
            relationship_issues: [], work_stress: [], financial_stress: [], identity_crisis: [],
            low_self_esteem: [], perfectionism: [], guilt_shame: [], greeting: [], general: []
        };

        // Enhanced Mental Health Response System - COMPLETE VERSION
        function generateIntelligentResponse(userMessage, conversationHistory = []) {
            const recentMessages = conversationHistory.slice(-4);
            
            const responses = {
                // CRISIS/SUICIDAL IDEATION - HIGHEST PRIORITY
                suicidal: [
                    "I'm really concerned about what you've shared with me, and I want you to know that I'm taking this seriously. What you're feeling right now is incredibly painful, but please know that you don't have to go through this alone. There are people trained specifically to help with these feelings who are available right now:\n\nâ€¢ US: 988 (Suicide & Crisis Lifeline) - available 24/7\nâ€¢ UK: 116 123 (Samaritans) - free, 24/7\nâ€¢ Crisis Text Line: Text HOME to 741741\n\nYour life has value, and these feelings can change with proper support. Are you in immediate danger right now, or can you stay safe while we talk about getting you connected with crisis support?"
                ],

                // BPD responses
                bpd: [
                    "BPD and loneliness can be such a painful combination. BPD often makes relationships feel both desperately needed and terrifyingly risky - the fear of abandonment can make you push people away before they can leave you, which then creates the very loneliness you were trying to avoid. The emotional intensity of BPD can make loneliness feel absolutely crushing, like you're drowning in emptiness. What's been most difficult about managing both the BPD symptoms and the loneliness?",
                    "Living with BPD can make you feel like you're 'too much' for people, which often leads to intense loneliness and isolation. The way BPD affects emotional regulation means that loneliness doesn't just feel sad - it can feel like emotional agony, like you're going to die from the emptiness. Are you currently using any DBT skills to help manage these intense feelings?"
                ],

                // Depression responses
                depression: [
                    "Depression can feel like you're trapped underwater while everyone else is breathing normally above the surface. That heaviness, the way simple tasks feel impossible, how everything loses its color and meaningâ€”it's not weakness, it's illness. What does today feel like for youâ€”is it a barely-surviving day or something different?",
                    "I hear you struggling with depression, and I want you to know that what you're experiencingâ€”the exhaustion that sleep doesn't fix, the numbness, the way your brain tells you nothing will ever get betterâ€”these are symptoms talking, not truth. What's been the hardest part about getting through each day lately?"
                ],

                // Anxiety responses
                anxiety: [
                    "Anxiety can feel like your nervous system is stuck in 'emergency mode' even when you're safe. That constant scanning for threats, the way your body reacts with racing heart and sweating to situations your logical brain knows aren't dangerousâ€”it's exhausting to live in that state of hypervigilance. What tends to trigger your anxiety most, and how are you feeling in your body right now?",
                    "I hear that you're feeling anxious. It's like your brain's alarm system is so sensitive that it goes off for everythingâ€”real dangers and imagined ones alike. The 'what if' thoughts can spiral so quickly, creating entire catastrophic scenarios that feel completely real and urgent. What's your anxiety telling you right now?"
                ],

                // Loneliness responses
                loneliness: [
                    "I hear you. Feeling lonely can be really heavyâ€”it's more than just 'being alone,' it's that sense of missing connection or understanding. That ache of wanting someone to truly see you can feel overwhelming sometimes. Would it help to talk about what's making the loneliness feel particularly intense right now, or would you prefer to explore some gentle ways to ease that feeling?",
                    "Loneliness has this way of making us feel invisible, doesn't it? Like you could be surrounded by people and still feel completely unseen. It's one of those emotions that can make everything else feel more difficult too. I'm here with you in this moment, and you're not bothering anyone by sharing this. What does your loneliness feel like right nowâ€”is it missing specific people, or more of a general feeling of disconnection?"
                ],

                // ADHD responses
                adhd: [
                    "ADHD can feel like living in a world designed for a completely different type of brain. The executive dysfunction, time blindness, rejection sensitivity, and the way your brain either hyperfocuses on the 'wrong' things or can't focus at all - it's not about being lazy or not trying hard enough. What aspect of ADHD is making life feel particularly challenging today?",
                    "The ADHD struggle is so real - your brain craves stimulation and novelty, but the world demands consistency and routine. The way criticism can feel devastating due to rejection sensitivity, and how impulsivity can lead to decisions you later regret, can create a cycle of shame. Are you feeling frustrated with the challenges right now?"
                ],

                // Autism responses
                autism: [
                    "Being autistic in a neurotypical world can be incredibly exhausting - constantly masking, trying to interpret social cues that don't come naturally, dealing with sensory overwhelm, and having your natural communication style misunderstood. It takes enormous energy to navigate a world that wasn't designed for your neurotype. What's been most challenging about being autistic lately?",
                    "Autism brings both incredible strengths and significant challenges. The deep focus and expertise in special interests, attention to detail, and authentic way of being are beautiful aspects of autism. But the social exhaustion, sensory issues, and need for routine in an unpredictable world can be overwhelming. How are you taking care of your sensory and social needs right now?"
                ],

                // PTSD responses
                ptsd: [
                    "PTSD can make you feel like you're stuck in a nightmare that your brain won't let you wake up from. The flashbacks, nightmares, hypervigilance, and emotional numbing are your nervous system's way of trying to protect you from perceived threats, even when you're safe. What's been most difficult about living with these trauma responses?",
                    "Trauma can rewire your brain and make the world feel perpetually unsafe, even in situations that logically you know are fine. The way PTSD affects sleep, relationships, and daily functioning shows how deeply trauma impacts every aspect of life. Are you currently getting any trauma-specific treatment?"
                ],

                // OCD responses
                ocd: [
                    "OCD can feel like having a bully living in your brain that never stops demanding you do 'just one more' ritual or feeding you intrusive thoughts that feel impossibly disturbing. The cycle of obsession and compulsion can take over your entire day and make you feel trapped. What types of obsessions or compulsions are you struggling with most right now?",
                    "The way OCD makes you doubt yourself constantly - 'Did I lock the door? Did I turn off the stove? What if I hurt someone?' - can be absolutely exhausting. People often don't understand that you know the thoughts are irrational, but they feel so real and urgent in the moment. How are you currently managing your OCD symptoms?"
                ],

                // Bipolar responses
                bipolar: [
                    "Living with bipolar disorder can feel like riding an emotional rollercoaster that you never asked to get on. The extreme highs of mania or hypomania followed by crushing lows of depression - it's exhausting and can make you feel like you're not in control of your own mind. Are you currently in a manic, hypomanic, or depressive episode, or somewhere in between?",
                    "Bipolar disorder can make you feel like you're living multiple lives - the person you are during mania feels completely different from who you are during depression. The mood swings, energy changes, and impact on relationships and work can be overwhelming. What's been most challenging about managing your bipolar symptoms lately?"
                ],

                // Panic disorder responses
                panic_disorder: [
                    "Panic attacks can feel like you're dying, going crazy, or losing complete control - even though they're not dangerous, they're absolutely terrifying when you're experiencing them. The fear of having another panic attack can become almost as disabling as the attacks themselves. What does a panic attack typically feel like for you?",
                    "Living with panic disorder often means being afraid of your own body - heart palpitations, shortness of breath, dizziness can all trigger the fear that something terrible is happening. Have you found any techniques that help you during or after a panic attack?"
                ],

                // Social anxiety responses
                social_anxiety: [
                    "Social anxiety can make every interaction feel like a performance where you're being judged and found wanting. The fear of embarrassment, rejection, or saying something wrong can be so intense that avoiding social situations feels like the only safe option. What social situations tend to trigger your anxiety most?",
                    "The exhaustion that comes with social anxiety - analyzing every interaction, worrying about what people think, rehearsing conversations in your head - can be overwhelming. It's not just shyness; it's a persistent fear that can significantly impact your life and relationships. How has social anxiety been affecting your daily life?"
                ],

                // Eating disorder responses
                eating_disorder: [
                    "Eating disorders are so much more than food - they're often about control, perfectionism, trauma, or managing overwhelming emotions. The relationship with food becomes a way to cope with things that feel impossible to handle otherwise. What's been most challenging about your relationship with food and your body lately?",
                    "The mental noise around food, body image, and eating can be absolutely deafening - every meal becomes a battleground, every mirror a source of distress. Eating disorders can make you feel isolated because they're often misunderstood as being 'just about food.' How are you taking care of yourself right now?"
                ],

                // Additional conditions with responses
                grief: [
                    "Grief is love with nowhere to go, and that can feel impossible to carry sometimes. Whether you're mourning a person, a relationship, a version of yourself, or a future you thought you'd have - that ache of missing something or someone is one of the most profound human experiences. What are you grieving right now?",
                    "There's something about grief that makes you feel like you're living in a different world from everyone else - they're going about their normal lives while you're walking around with this huge absence inside you. What do you need most right now - space to feel it, distraction from it, or someone to just acknowledge how hard this is?"
                ],

                addiction: [
                    "Addiction often starts as a solution to unbearable emotional pain, but then becomes its own source of suffering. The shame, secrecy, and feeling out of control can make you feel trapped in a cycle you can't break. Recovery is possible, but it's rarely a straight line. Where are you right now in your relationship with substances or addictive behaviors?",
                    "The disease of addiction can make you feel like you're watching yourself make destructive choices while feeling powerless to stop. What kind of support do you have right now, and what feels most challenging about recovery?"
                ],

                overwhelmed: [
                    "Feeling overwhelmed is like having too many browser tabs open in your mind - everything is running at once and it's slowing down your whole system. When everything feels urgent and important, it can be paralyzing because you don't know where to start. What's contributing most to feeling overwhelmed right now?",
                    "That overwhelmed feeling can be suffocating - like the walls are closing in and there's not enough air. When your capacity is maxed out, even small things can feel like the last straw. What would it look like to give yourself permission to not handle everything perfectly right now?"
                ],

                // Follow-up responses
                general_followup: [
                    "I can see you're looking for more specific guidance about what to do next. Sometimes when we're struggling, the path forward isn't clear. What feels most urgent or pressing for you right now - is it getting through today, figuring out a specific problem, or finding someone to talk to?",
                    "It sounds like you need some concrete next steps. When everything feels overwhelming, sometimes the most helpful thing is to focus on just the next small action. What's one thing you could do in the next hour that might help you feel even slightly better?"
                ],

                // Greeting responses
                greeting: [
                    "Hello! I'm really glad you're here. This feels like a safe space where you can share whatever is truly on your mindâ€”the heavy stuff, the confusing stuff, or even just the everyday struggles that feel bigger than they should. How are you really doing today?",
                    "Hi there! Thank you for reaching out. Sometimes it takes courage just to start a conversation, especially when you're not sure what you need or how to put your feelings into words. What's been on your heart or mind lately?"
                ],

                // General responses
                general: [
                    "Thank you for sharing that with me. I can sense there's something on your mind, and I want you to know that whatever you're experiencing is completely valid. You don't have to have the perfect words or even understand your emotions fully. What's been weighing on you lately?",
                    "I really appreciate you opening up here. It takes vulnerability to reach out, especially when you might not even be sure what kind of support you need. You don't have to carry everything alone. What would feel most supportive for you right now?",
                    "I'm here to listen to whatever you're going through. This is a safe space where your feelings matter and are valid. Sometimes just putting our thoughts into words can provide a little relief. What's on your mind that you haven't had space to process elsewhere?",
                    "I hear you reaching out, and that takes strength even when you might not feel strong right now. Whatever brought you here to share with me is important. Would you like to tell me more about what's happening for you today?"
                ]
            };

            const lowerMessage = userMessage.toLowerCase();
            let responseCategory = 'general';
            
            // ENHANCED DETECTION LOGIC
            if (lowerMessage.includes('suicidal') || lowerMessage.includes('kill myself') || lowerMessage.includes('want to die')) {
                responseCategory = 'suicidal';
            }
            else if (lowerMessage.includes('bpd') || lowerMessage.includes('borderline')) {
                responseCategory = 'bpd';
            }
            else if (lowerMessage.includes('lonely') || lowerMessage.includes('loneliness') || lowerMessage.includes('alone')) {
                responseCategory = 'loneliness';
            }
            // ENHANCED DETECTION LOGIC
            if (lowerMessage.includes('suicidal') || lowerMessage.includes('kill myself') || lowerMessage.includes('want to die')) {
                responseCategory = 'suicidal';
            }
            else if (lowerMessage.includes('bpd') || lowerMessage.includes('borderline')) {
                responseCategory = 'bpd';
            }
            else if (lowerMessage.includes('bipolar') || lowerMessage.includes('manic') || lowerMessage.includes('hypomania')) {
                responseCategory = 'bipolar';
            }
            else if (lowerMessage.includes('ptsd') || lowerMessage.includes('trauma') || lowerMessage.includes('flashback')) {
                responseCategory = 'ptsd';
            }
            else if (lowerMessage.includes('ocd') || lowerMessage.includes('obsessive') || lowerMessage.includes('compulsive')) {
                responseCategory = 'ocd';
            }
            else if (lowerMessage.includes('eating disorder') || lowerMessage.includes('anorexia') || lowerMessage.includes('bulimia')) {
                responseCategory = 'eating_disorder';
            }
            else if (lowerMessage.includes('adhd') || lowerMessage.includes('add') || lowerMessage.includes('attention deficit')) {
                responseCategory = 'adhd';
            }
            else if (lowerMessage.includes('autism') || lowerMessage.includes('autistic') || lowerMessage.includes('neurodivergent')) {
                responseCategory = 'autism';
            }
            else if (lowerMessage.includes('panic attack') || lowerMessage.includes('panic disorder')) {
                responseCategory = 'panic_disorder';
            }
            else if (lowerMessage.includes('social anxiety') || lowerMessage.includes('social phobia')) {
                responseCategory = 'social_anxiety';
            }
            else if (lowerMessage.includes('grief') || lowerMessage.includes('grieving') || lowerMessage.includes('loss')) {
                responseCategory = 'grief';
            }
            else if (lowerMessage.includes('addiction') || lowerMessage.includes('alcoholism') || lowerMessage.includes('substance')) {
                responseCategory = 'addiction';
            }
            else if (lowerMessage.includes('overwhelmed') || lowerMessage.includes('burnout') || lowerMessage.includes('too much')) {
                responseCategory = 'overwhelmed';
            }
            else if (lowerMessage.includes('lonely') || lowerMessage.includes('loneliness') || lowerMessage.includes('alone')) {
                responseCategory = 'loneliness';
            }
            else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad')) {
                responseCategory = 'depression';
            }
            else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried')) {
                responseCategory = 'anxiety';
            }
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                responseCategory = 'greeting';
            }
            else if (recentMessages.length > 0 && (lowerMessage.includes('what should') || lowerMessage.includes('what do'))) {
                responseCategory = 'general_followup';
            }
            
            // Get response from category, avoiding repetition
            const categoryResponses = responses[responseCategory] || responses['general'];
            const usedCategoryResponses = usedResponses[responseCategory] || [];
            
            // Find unused responses
            const unusedResponses = categoryResponses.filter(response => 
                !usedCategoryResponses.includes(response)
            );
            
            let selectedResponse;
            if (unusedResponses.length > 0) {
                selectedResponse = unusedResponses[Math.floor(Math.random() * unusedResponses.length)];
            } else {
                usedResponses[responseCategory] = [];
                selectedResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            }
            
            // Track this response as used
            if (!usedResponses[responseCategory]) {
                usedResponses[responseCategory] = [];
            }
            usedResponses[responseCategory].push(selectedResponse);
            
            return { choices: [{ message: { content: selectedResponse } }] };
        }

        // ChatGPT API call function  
async function callChatGPT(messages) {
    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${OPENAI_API_KEY}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                model: "gpt-4", // Change from gpt-5 to gpt-4
                messages: messages,
                temperature: 0.75,
                top_p: 0.9,
                max_tokens: 800,
                frequency_penalty: 0.3,
                presence_penalty: 0.1,
            })
        });
        
        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('OpenAI API Error:', error);
        // Fall back to intelligent response system
        const lastUserMessage = messages[messages.length - 1].content;
        return generateIntelligentResponse(lastUserMessage, messages);
    }
}
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: "gpt-5", // Update this when GPT-5 is officially released, currently use "gpt-4" or "gpt-4-turbo"
                        messages: messages,
                        temperature: 0.75, // Reduced for more consistent, less repetitive responses
                        top_p: 0.9, // Nucleus sampling for better quality
                        max_tokens: 800, // Sufficient for detailed mental health responses
                        frequency_penalty: 0.3, // Reduces repetitive phrasing
                        presence_penalty: 0.1, // Encourages diverse vocabulary
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('OpenAI API Error:', error);
                // Fall back to intelligent response system
                const lastUserMessage = messages[messages.length - 1].content;
                return generateIntelligentResponse(lastUserMessage, messages);
            }
            */
            
            // For now, using the enhanced fallback intelligent response system
            const lastUserMessage = messages[messages.length - 1].content;
            return generateIntelligentResponse(lastUserMessage, messages);
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Disable send button and input
            sendButton.disabled = true;
            input.disabled = true;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Add user message to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });

                // Call ChatGPT 5.0 API with intelligent fallback
                const data = await callChatGPT(conversationHistory);
                const aiResponse = data.choices[0].message.content.trim();
                
                // Add AI response to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: aiResponse
                });

                // Keep conversation history manageable
                if (conversationHistory.length > 21) {
                    conversationHistory = [
                        conversationHistory[0], // Keep system prompt
                        ...conversationHistory.slice(-20) // Keep last 20 messages
                    ];
                }

                hideTypingIndicator();
                addMessage(aiResponse, 'ai');

            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                
                // Fallback to intelligent response
                const fallbackResponse = generateIntelligentResponse(message, conversationHistory);
                addMessage(fallbackResponse.choices[0].message.content, 'ai');
            } finally {
                // Re-enable send button and input
                sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function addMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = content;
            
            // Remove welcome section after first user message
            if (sender === 'user') {
                const welcomeSection = document.querySelector('.welcome-section');
                if (welcomeSection) {
                    welcomeSection.remove();
                }
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            const chatArea = document.getElementById('chatArea');
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('messageInput').focus();
        });
    </script>
</body>
</html>
