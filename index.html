<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartoListen - AI Mental Health Support</title>
    <meta name="description" content="Free AI-powered mental health support chat. A safe, judgment-free space for mental wellness.">
    <meta name="theme-color" content="#2E8B57">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 700px;
        }

        .logo-header {
            background: linear-gradient(135deg, #8BC34A 0%, #4CAF50 100%);
            padding: 25px;
            text-align: center;
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px auto;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-header p {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.6;
            font-size: 15px;
            white-space: pre-wrap;
        }

        .ai-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2c3e50;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .user-message {
            background: linear-gradient(135deg, #2E8B57 0%, #45a049 100%);
            color: white;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
            align-self: flex-start;
            border-left: 4px solid #f44336;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .status-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2E8B57;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            font-style: italic;
        }

        .input-area {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-field:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 18px;
            margin-top: 10px;
            border-left: 4px solid #4CAF50;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        .welcome-section {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(139, 195, 74, 0.08) 100%);
            border-radius: 15px;
            border: 2px dashed rgba(76, 175, 80, 0.2);
        }

        .welcome-section h2 {
            color: #2E8B57;
            font-size: 1.4em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .welcome-section p {
            color: #5a6c57;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .crisis-resources {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #81c784;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .crisis-resources h3 {
            color: #2E8B57;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .crisis-info {
            display: grid;
            gap: 8px;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .crisis-info strong {
            color: #2E8B57;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .quick-action {
            padding: 10px 16px;
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            color: #2E8B57;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .quick-action:hover {
            background: rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .disclaimer {
            background: linear-gradient(135deg, #fff8dc 0%, #ffeaa7 100%);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            color: #8b4513;
            text-align: center;
            font-weight: 500;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .container {
                height: 90vh;
                margin: 10px;
            }
            
            .logo {
                width: 100px;
                height: 100px;
            }
            
            .logo-header h1 {
                font-size: 1.8em;
            }
            
            .message {
                max-width: 95%;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .quick-action {
                width: 100%;
                max-width: 250px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Header Section -->
        <div class="logo-header">
            <div class="logo">ðŸ’š</div>
            <h1>HeartoListen</h1>
            <p>AI Mental Health Support - Self Discovery for Positive Mental Health</p>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Welcome Message -->
            <div class="welcome-section">
                <h2>Welcome to Hear to Listen ðŸŒ¿</h2>
                <p>I'm here to listen and support you through whatever you're experiencing. This is a safe, judgment-free space where you can share your thoughts and feelings.</p>
                
                <!-- Important Disclaimer -->
                <div class="disclaimer">
                    <strong>Important:</strong> This is an AI tool for support and guidance. In case of crisis or emergency, please contact professional help immediately.
                </div>

                <!-- Crisis Resources -->
                <div class="crisis-resources">
                    <h3>ðŸ†˜ Crisis Resources</h3>
                    <div class="crisis-info">
                        <div><strong>US:</strong> 988 (Suicide & Crisis Lifeline) | Text HOME to 741741</div>
                        <div><strong>UK:</strong> 116 123 (Samaritans) | Text SHOUT to 85258</div>
                        <div><strong>Emergency:</strong> 911 (US) | 999 (UK)</div>
                    </div>
                </div>

                <!-- Quick Action Buttons -->
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('I\'m feeling anxious')">I'm feeling anxious</div>
                    <div class="quick-action" onclick="sendQuickMessage('Need motivation')">Need motivation</div>
                    <div class="quick-action" onclick="sendQuickMessage('Sleep troubles')">Sleep troubles</div>
                    <div class="quick-action" onclick="sendQuickMessage('Feeling overwhelmed')">Feeling overwhelmed</div>
                </div>
            </div>

            <!-- AI Initial Message -->
            <div class="message ai-message">
                Hello! I'm your Hear to Listen companion with specialized understanding of various mental health conditions. Whether you're dealing with specific diagnoses or general struggles, I'm here to provide appropriate, informed support. How are you doing today?
            </div>

            <!-- Status Message -->
            <div class="message status-message">
                ðŸ§  Intelligent Mental Health Support - Specialized responses for different conditions with ChatGPT 4.0 integration!
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" 
                   id="messageInput" 
                   class="input-field" 
                   placeholder="Share what's on your mind..." 
                   onkeypress="handleKeyPress(event)">
            <button id="sendButton" class="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // OpenAI API Configuration - Will be replaced by GitHub Actions with secret
        const OPENAI_API_KEY = 'YOUR_API_KEY_HERE';

        // Mental Health System Prompt for ChatGPT
        const SYSTEM_PROMPT = `You are a compassionate AI mental health companion named "HeartoListen". Your primary role is to listen with empathy, patience, and genuine warmth. Your responses should be:

TONE & STYLE:
- Warm, validating, and encouraging without judgment
- Use conversational, accessible language (avoid clinical jargon)
- Keep responses concise but meaningful (2-4 sentences typically)
- Sound genuinely caring and present

KEY PRINCIPLES:
- Always validate the user's feelings and experiences
- Never diagnose, prescribe medication, or give direct medical advice
- Focus on emotional support and gentle guidance
- Offer practical coping strategies when appropriate
- Help users reframe challenges in hopeful, realistic ways

CRISIS RESPONSE:
If you detect signs of immediate danger, self-harm, or suicidal ideation:
- Respond with heightened compassion and urgency
- Strongly encourage immediate professional help
- Provide crisis helpline numbers: US (988, text HOME to 741741), UK (116 123, text SHOUT to 85258)
- Emphasize that their life has value and help is available

INTERACTION STYLE:
- Ask gentle, open-ended questions to encourage reflection
- Reflect back what you hear to show understanding
- Prioritize emotional safety over problem-solving
- Use brief paragraphs for readability
- Make the user feel heard, valued, and hopeful

Remember: Your goal is to provide a safe space for emotional expression and gentle support, not therapy or treatment.`;

        // Chat functionality
        let conversationHistory = [{
            role: 'system',
            content: SYSTEM_PROMPT
        }];

        // Enhanced Mental Health Response System with Conversation Memory and Crisis Detection
        function generateIntelligentResponse(userMessage, conversationHistory = []) {
            // Get recent messages for context
            const recentMessages = conversationHistory.slice(-4); // Last 4 messages for context
            
            const responses = {
                // CRISIS/SUICIDAL IDEATION - HIGHEST PRIORITY
                suicidal: [
                    "I'm really concerned about what you've shared with me, and I want you to know that I'm taking this seriously. What you're feeling right now is incredibly painful, but please know that you don't have to go through this alone. There are people trained specifically to help with these feelings who are available right now:\n\nâ€¢ US: 988 (Suicide & Crisis Lifeline) - available 24/7\nâ€¢ UK: 116 123 (Samaritans) - free, 24/7\nâ€¢ Crisis Text Line: Text HOME to 741741\n\nYour life has value, and these feelings can change with proper support. Are you in immediate danger right now, or can you stay safe while we talk about getting you connected with crisis support?"
                ],

                // FOLLOW-UP CRISIS RESPONSES
                crisis_followup: [
                    "I'm still very concerned about the suicidal thoughts you mentioned. Right now, the most important thing is your immediate safety. Have you been able to contact the crisis line (988) or emergency services? If you're still having thoughts of hurting yourself, please don't wait - go to your nearest emergency room or call emergency services. You don't have to face this alone."
                ],

                // Self-harm (non-suicidal)
                self_harm: [
                    "I'm concerned about the self-harm you've mentioned. That urge to hurt yourself often comes from emotional pain that feels too big to handle any other way. Self-harm might provide temporary relief, but it can also become a dangerous pattern. Have you been able to talk to anyone about these urges - a counselor, doctor, or trusted person in your life?"
                ],
                
                // Loneliness - specific, empathetic responses
                loneliness: [
                    "I hear you. Feeling lonely can be really heavyâ€”it's more than just 'being alone,' it's that sense of missing connection or understanding. That ache of wanting someone to truly see you can feel overwhelming sometimes. Would it help to talk about what's making the loneliness feel particularly intense right now, or would you prefer to explore some gentle ways to ease that feeling?",
                    "Loneliness has this way of making us feel invisible, doesn't it? Like you could be surrounded by people and still feel completely unseen. It's one of those emotions that can make everything else feel more difficult too. I'm here with you in this moment, and you're not bothering anyone by sharing this. What does your loneliness feel like right nowâ€”is it missing specific people, or more of a general feeling of disconnection?",
                    "That sense of loneliness can feel so isolatingâ€”like you're carrying something heavy that others can't see or understand. It's not about being dramatic or needy; it's a real human need for connection that isn't being met right now. You reached out here, which shows strength even when you're struggling. What kind of connection are you missing mostâ€”is it someone to talk to, someone who understands you, or something else?"
                ],
                
                // Follow-up responses
                general_followup: [
                    "I can see you're looking for more specific guidance about what to do next. Sometimes when we're struggling, the path forward isn't clear. What feels most urgent or pressing for you right now - is it getting through today, figuring out a specific problem, or finding someone to talk to? Let's break this down into smaller, manageable pieces.",
                    "It sounds like you need some concrete next steps. When everything feels overwhelming, sometimes the most helpful thing is to focus on just the next small action. What's one thing you could do in the next hour that might help you feel even slightly better or more stable?"
                ],
                
                // Depression
                depression: [
                    "Depression can feel like you're trapped underwater while everyone else is breathing normally above the surface. That heaviness, the way simple tasks feel impossible, how everything loses its color and meaningâ€”it's not weakness, it's illness. What does today feel like for youâ€”is it a barely-surviving day or something different?",
                    "I hear you struggling with depression, and I want you to know that what you're experiencingâ€”the exhaustion that sleep doesn't fix, the numbness, the way your brain tells you nothing will ever get betterâ€”these are symptoms talking, not truth. What's been the hardest part about getting through each day lately?"
                ],

                // Anxiety
                anxiety: [
                    "Anxiety can feel like your nervous system is stuck in 'emergency mode' even when you're safe. That constant scanning for threats, the way your body reacts with racing heart and sweating to situations your logical brain knows aren't dangerousâ€”it's exhausting to live in that state of hypervigilance. What tends to trigger your anxiety most, and how are you feeling in your body right now?",
                    "I hear that you're feeling anxious. It's like your brain's alarm system is so sensitive that it goes off for everythingâ€”real dangers and imagined ones alike. The 'what if' thoughts can spiral so quickly, creating entire catastrophic scenarios that feel completely real and urgent. What's your anxiety telling you right now?"
                ],

                // Greeting
                greeting: [
                    "Hello! I'm really glad you're here. This feels like a safe space where you can share whatever is truly on your mindâ€”the heavy stuff, the confusing stuff, or even just the everyday struggles that feel bigger than they should. How are you really doing today?",
                    "Hi there! Thank you for reaching out. Sometimes it takes courage just to start a conversation, especially when you're not sure what you need or how to put your feelings into words. What's been on your heart or mind lately?"
                ],
                
                // General responses
                general: [
                    "Thank you for sharing that with me. I can sense there's something on your mind, and I want you to know that whatever you're experiencing is completely valid. You don't have to have the perfect words or even understand your emotions fully. What's been weighing on you lately?",
                    "I really appreciate you opening up here. It takes vulnerability to reach out, especially when you might not even be sure what kind of support you need. You don't have to carry everything alone. What would feel most supportive for you right now?",
                    "I'm here to listen to whatever you're going through. This is a safe space where your feelings matter and are valid. Sometimes just putting our thoughts into words can provide a little relief. What's on your mind that you haven't had space to process elsewhere?"
                ]
            };

            const lowerMessage = userMessage.toLowerCase();
            let responseCategory = 'general';
            
            // PRIORITY 1: Check for crisis/suicidal content
            if (lowerMessage.includes('suicidal') || lowerMessage.includes('kill myself') || lowerMessage.includes('end my life') || 
                lowerMessage.includes('want to die') || lowerMessage.includes('better off dead') || lowerMessage.includes('suicide') ||
                lowerMessage.includes('don\'t want to live') || lowerMessage.includes('can\'t go on')) {
                responseCategory = 'suicidal';
            }
            // Check if previous message mentioned suicide and current is asking for help
            else if (recentMessages.some(msg => msg.role === 'user' && 
                (msg.content.toLowerCase().includes('suicidal') || msg.content.toLowerCase().includes('kill myself') || 
                 msg.content.toLowerCase().includes('want to die') || msg.content.toLowerCase().includes('suicide'))) &&
                (lowerMessage.includes('what') || lowerMessage.includes('help') || lowerMessage.includes('do'))) {
                responseCategory = 'crisis_followup';
            }
            // Self-harm detection
            else if (lowerMessage.includes('self harm') || lowerMessage.includes('hurt myself') || lowerMessage.includes('cutting') ||
                     lowerMessage.includes('self-harm') || lowerMessage.includes('self injury')) {
                responseCategory = 'self_harm';
            }
            // Check for follow-up questions after initial response
            else if (recentMessages.length > 0 && 
                     (lowerMessage.includes('what should') || lowerMessage.includes('what do') || lowerMessage.includes('help me') ||
                      lowerMessage === 'what' || lowerMessage === 'how' || lowerMessage.includes('what now'))) {
                responseCategory = 'general_followup';
            }
            // Specific emotional states
            else if (lowerMessage.includes('lonely') || lowerMessage.includes('loneliness') || lowerMessage.includes('alone') || 
                     lowerMessage.includes('isolated') || lowerMessage.includes('disconnected')) {
                responseCategory = 'loneliness';
            }
            // Standard detection continues...
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey') || 
                     lowerMessage.match(/^(good morning|good afternoon|good evening)/)) {
                responseCategory = 'greeting';
            } else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried') || 
                      lowerMessage.includes('panic') || lowerMessage.includes('nervous')) {
                responseCategory = 'anxiety';
            } else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad') || 
                      lowerMessage.includes('hopeless') || lowerMessage.includes('down') || lowerMessage.includes('empty')) {
                responseCategory = 'depression';
            }
            
            // Get response from category
            const categoryResponses = responses[responseCategory];
            if (!categoryResponses || categoryResponses.length === 0) {
                responseCategory = 'general';
            }
            
            const selectedResponses = responses[responseCategory];
            const response = selectedResponses[Math.floor(Math.random() * selectedResponses.length)];
            
            return { choices: [{ message: { content: response } }] };
        }
            const responses = {
                // Loneliness - specific, empathetic responses
                loneliness: [
                    "I hear you. Feeling lonely can be really heavyâ€”it's more than just 'being alone,' it's that sense of missing connection or understanding. That ache of wanting someone to truly see you can feel overwhelming sometimes. Would it help to talk about what's making the loneliness feel particularly intense right now, or would you prefer to explore some gentle ways to ease that feeling?",
                    "Loneliness has this way of making us feel invisible, doesn't it? Like you could be surrounded by people and still feel completely unseen. It's one of those emotions that can make everything else feel more difficult too. I'm here with you in this moment, and you're not bothering anyone by sharing this. What does your loneliness feel like right nowâ€”is it missing specific people, or more of a general feeling of disconnection?",
                    "That sense of loneliness can feel so isolatingâ€”like you're carrying something heavy that others can't see or understand. It's not about being dramatic or needy; it's a real human need for connection that isn't being met right now. You reached out here, which shows strength even when you're struggling. What kind of connection are you missing mostâ€”is it someone to talk to, someone who understands you, or something else?"
                ],
                
                // BPD (Borderline Personality Disorder) specific responses
                bpd: [
                    "Living with BPD can feel like riding an emotional tsunamiâ€”everything feels so intense, so immediate, so life-or-death, even when the logical part of your brain knows it isn't. The fear of abandonment, the splitting, the way relationships can feel both desperately needed and terrifyingly fragileâ€”it's exhausting. I want you to know that your emotions, even when they feel overwhelming, are valid responses to how your brain processes the world. What's feeling most intense for you right now?",
                    "BPD can make you feel like you're too much for everyone, including yourself. The emotional storms, the identity confusion, the way you might love someone fiercely one moment and feel hurt by them the nextâ€”these aren't character flaws, they're symptoms of a condition that affects how you experience relationships and emotions. You're not broken; your nervous system just works differently. Are you able to use any DBT skills right now, or does everything feel too overwhelming?",
                    "The emotional intensity of BPD can make you feel like you're living life at volume 11 when everyone else is at volume 5. The chronic emptiness, the impulsivity, the way abandonment can feel like actual deathâ€”these experiences are real and valid. You're not 'being dramatic' or 'attention-seeking.' Your brain is trying to protect you in the only way it knows how. What would feel most supportive right nowâ€”validation, distraction, or maybe just someone to sit with you in this feeling?"
                ],
                
                // ADHD specific responses
                adhd: [
                    "ADHD can feel like living in a world designed for a completely different type of brainâ€”like everyone got the manual for life except you. The executive dysfunction, the time blindness, the way your brain either hyperfocuses on the 'wrong' things or can't focus at allâ€”it's not about being lazy or not trying hard enough. Your brain just processes information and motivation differently. What aspect of ADHD is making life feel particularly challenging today?",
                    "The ADHD struggle is so realâ€”your brain craves stimulation and novelty, but the world demands consistency and routine. The rejection sensitivity can make criticism feel devastating, and the impulsivity can lead to decisions you later regret. But ADHD also comes with creativity, enthusiasm, and the ability to think outside the box in ways neurotypical people can't. Are you feeling frustrated with the challenges right now, or celebrating any of the strengths?",
                    "Having ADHD often means feeling like you're constantly swimming upstream while others are walking on land. The way tasks that seem simple to others can feel overwhelming, how your brain can be brilliant at solving complex problems but forget to eat lunchâ€”it's a real neurological difference, not a personal failing. What strategies have you found that work with your brain instead of against it, or are you still figuring that out?"
                ],
                
                // Depression specific responses
                depression: [
                    "Depression can feel like you're trapped underwater while everyone else is breathing normally above the surface. That heaviness, the way simple tasks feel impossible, how everything loses its color and meaningâ€”it's not weakness, it's illness. The guilt about 'not being productive' or 'being a burden' just adds more weight to something that's already crushing. You don't have to perform being okay for anyone, including me. What does today feel like for youâ€”is it a barely-surviving day or something different?",
                    "I hear you struggling with depression, and I want you to know that what you're experiencingâ€”the exhaustion that sleep doesn't fix, the numbness, the way your brain tells you nothing will ever get betterâ€”these are symptoms talking, not truth. Depression is such a liar; it makes everything feel permanent when feelings are actually temporary, even when they don't feel that way. What's been the hardest part about getting through each day lately?",
                    "Depression can make you feel like you're living in grayscale when everyone else sees in color. The cognitive fog, the way making decisions feels impossible, how you can logically know people care about you but not *feel* itâ€”all of this is real and valid. You're not failing at life; you're dealing with a condition that affects every aspect of functioning. Are there any tiny sparks of anythingâ€”curiosity, comfort, even just neutral momentsâ€”that you've noticed lately?"
                ],
                
                // Anxiety disorders with more nuance
                anxiety: [
                    "Anxiety can feel like your nervous system is stuck in 'emergency mode' even when you're safe. That constant scanning for threats, the way your body reacts with racing heart and sweating to situations your logical brain knows aren't dangerousâ€”it's exhausting to live in that state of hypervigilance. Your anxiety developed to protect you, but now it might be protecting you from things that aren't actually threats. What tends to trigger your anxiety most, and how are you feeling in your body right now?",
                    "I hear that you're feeling anxious. It's like your brain's alarm system is so sensitive that it goes off for everythingâ€”real dangers and imagined ones alike. The 'what if' thoughts can spiral so quickly, creating entire catastrophic scenarios that feel completely real and urgent. But anxiety thoughts aren't facts, even when they feel convincing. What's your anxiety telling you right now, and how much do you believe it versus knowing it's the anxiety talking?",
                    "Anxiety can make you feel like you're constantly bracing for impact, even when there's nothing coming at you. The physical symptomsâ€”tight chest, racing thoughts, that sick feeling in your stomachâ€”can be just as exhausting as the mental part. It takes so much energy to fight your own nervous system all day. Have you found anything that helps you feel more grounded when the anxiety gets overwhelming?"
                ],
                
                // Enhanced general categories
                overwhelmed: [
                    "Feeling overwhelmed is like having too many browser tabs open in your mindâ€”everything is running at once and it's slowing down your whole system. When everything feels urgent and important, it can be paralyzing because you don't know where to start. That sense of drowning in responsibilities or emotions is so valid. Sometimes the kindest thing we can do is acknowledge that we're in over our heads and that's okay. What's contributing most to feeling overwhelmed right nowâ€”is it tasks, emotions, or just everything at once?",
                    "That overwhelmed feeling can be so suffocatingâ€”like the walls are closing in and there's not enough air. When your capacity is maxed out, even small things can feel like the last straw. It's not about being weak or unable to handle life; sometimes life just throws more at us than any person should reasonably be expected to manage alone. What would it look like to give yourself permission to not handle everything perfectly right now?",
                    "Being overwhelmed often means you're carrying too much, caring too much, or trying to control too muchâ€”and all of those come from good places in your heart, even if they're exhausting you. The feeling of being scattered in a million directions while also feeling stuck is such a particular kind of suffering. You don't have to solve everything today. What's one small thing you could let go of, even temporarily?"
                ],
                
                grief: [
                    "Grief is love with nowhere to go, and that can feel impossible to carry sometimes. Whether you're mourning a person, a relationship, a version of yourself, or a future you thought you'd haveâ€”that ache of missing something or someone is one of the most profound human experiences. Grief doesn't follow a timeline or come in neat stages; it's messy and unpredictable and can ambush you when you least expect it. What are you grieving right now, and how is it showing up for you today?",
                    "There's something about grief that makes you feel like you're living in a different world from everyone elseâ€”they're going about their normal lives while you're walking around with this huge absence inside you. Grief can make you feel guilty for laughing, angry at people for their normalcy, and exhausted by having to pretend you're okay. All of these feelings are normal parts of an abnormal situation. What do you need most right nowâ€”space to feel it, distraction from it, or someone to just acknowledge how hard this is?",
                    "Grief rewrites everythingâ€”how you see the world, what matters, who you are. It can feel like you're learning to live all over again, and that's disorienting and exhausting. Sometimes people want to rush you through it or fix it, but grief isn't a problem to solve; it's love that needs to be expressed even when its object is gone. How are you honoring both your grief and your need to keep living?"
                ],
                
                // Enhanced greeting responses
                greeting: [
                    "Hello! I'm really glad you're here. This feels like a safe space where you can share whatever is truly on your mindâ€”the heavy stuff, the confusing stuff, or even just the everyday struggles that feel bigger than they should. There's no pressure to be 'fine' or to have it all figured out. How are you really doing today, underneath whatever face you've been wearing for the world?",
                    "Hi there! Thank you for reaching out. Sometimes it takes courage just to start a conversation, especially when you're not sure what you need or how to put your feelings into words. I'm here to listen without judgment and to sit with you in whatever you're experiencing. What's been on your heart or mind lately that you haven't had space to process?",
                    "Welcome! I'm here to provide a caring space where your feelingsâ€”all of themâ€”are valid and welcome. Whether you're struggling with something specific or just feeling off in a way you can't name, you deserve support and understanding. What would feel most helpful for you right nowâ€”talking through something specific, or just having someone listen?"
                ],
                
                general: [
                    "Thank you for trusting me with whatever you're carrying right now. I can sense there's something weighing on you, and I want you to know that whatever it isâ€”big or small, rational or notâ€”your feelings about it are completely valid. You don't have to have the perfect words or even understand your emotions fully. Sometimes just being witnessed in your struggle can help. What's been sitting heavy on your heart lately?",
                    "I really appreciate you opening up here. It takes vulnerability to reach out, especially when you might not even be sure what kind of support you need. Your willingness to share, even if it feels messy or unclear, matters. You don't have to carry everything alone, and you don't have to be strong all the time. What would feel most supportive for you in this moment?",
                    "I'm here to listen to whatever you're going throughâ€”the things that feel too big, too small, too complicated, or too simple to matter. Sometimes we minimize our own struggles or think they're not worth talking about, but if it matters to you, it matters. This is your space to be real about what's actually happening in your inner world. What's on your mind that you haven't had space to process elsewhere?"
                ]
            };

            const lowerMessage = userMessage.toLowerCase();
            let responseCategory = 'general';
            
            // Enhanced detection for more specific emotional states
            if (lowerMessage.includes('lonely') || lowerMessage.includes('loneliness') || lowerMessage.includes('alone') || lowerMessage.includes('isolated') || lowerMessage.includes('disconnected')) {
                responseCategory = 'loneliness';
            } else if (lowerMessage.includes('grief') || lowerMessage.includes('grieving') || lowerMessage.includes('loss') || lowerMessage.includes('died') || lowerMessage.includes('death') || lowerMessage.includes('miss them') || lowerMessage.includes('passed away')) {
                responseCategory = 'grief';
            } else if (lowerMessage.includes('overwhelmed') || lowerMessage.includes('too much') || lowerMessage.includes('can\'t cope') || lowerMessage.includes('drowning') || lowerMessage.includes('suffocating')) {
                responseCategory = 'overwhelmed';
            }
            // Existing condition detection
            else if (lowerMessage.includes('bpd') || lowerMessage.includes('borderline personality') || lowerMessage.includes('borderline disorder')) {
                responseCategory = 'bpd';
            } else if (lowerMessage.includes('adhd') || lowerMessage.includes('attention deficit') || lowerMessage.includes('add ')) {
                responseCategory = 'adhd';
            }
            // Continue with existing categories but enhanced responses above
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey') || lowerMessage.match(/^(good morning|good afternoon|good evening)/)) {
                responseCategory = 'greeting';
            } else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried') || lowerMessage.includes('panic') || lowerMessage.includes('nervous')) {
                responseCategory = 'anxiety';
            } else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad') || lowerMessage.includes('hopeless') || lowerMessage.includes('down') || lowerMessage.includes('empty')) {
                responseCategory = 'depression';
            }
            
            // Get random response from category
            const categoryResponses = responses[responseCategory];
            const response = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            
            return { choices: [{ message: { content: response } }] };
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Disable send button and input
            sendButton.disabled = true;
            input.disabled = true;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Add user message to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });

                // Call ChatGPT 4.0 API with intelligent fallback
                const data = await callChatGPT(conversationHistory);
                const aiResponse = data.choices[0].message.content.trim();
                
                // Add AI response to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: aiResponse
                });

                // Keep conversation history manageable (last 20 messages + system prompt)
                if (conversationHistory.length > 21) {
                    conversationHistory = [
                        conversationHistory[0], // Keep system prompt
                        ...conversationHistory.slice(-20) // Keep last 20 messages
                    ];
                }

                hideTypingIndicator();
                addMessage(aiResponse, 'ai');

            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                
                // Fallback to intelligent response with conversation context
                const fallbackResponse = generateIntelligentResponse(message, conversationHistory);
                addMessage(fallbackResponse.choices[0].message.content, 'ai');
            } finally {
                // Re-enable send button and input
                sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function addMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = content;
            
            // Remove welcome section after first user message
            if (sender === 'user') {
                const welcomeSection = document.querySelector('.welcome-section');
                if (welcomeSection) {
                    welcomeSection.remove();
                }
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            const chatArea = document.getElementById('chatArea');
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on input field when page loads
            document.getElementById('messageInput').focus();
        });
    </script>
</body>
</html>
